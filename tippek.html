<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VSPORT â€“ Forma & TeljesÃ­tmÃ©ny</title>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { background: #0a0a0a; color: #fff; font-family: 'Segoe UI', sans-serif; min-height: 100vh; }

    header {
      background: #111; border-bottom: 2px solid #222;
      padding: 0 20px; height: 44px;
      display: flex; align-items: center; gap: 10px;
      position: sticky; top: 0; z-index: 100;
    }
    .dot { width: 9px; height: 9px; border-radius: 50%; background: #fff; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.25} }
    header h1 { font-size:.85rem; font-weight:600; letter-spacing:3px; text-transform:uppercase; color:#ddd; }
    .back-btn {
      display: flex; align-items: center; gap: 5px;
      color: #888; font-size: .75rem; text-decoration: none;
      padding: 5px 10px; border: 1px solid #222; border-radius: 4px;
      transition: all .15s;
    }
    .back-btn:hover { color: #fff; border-color: #444; }
    .header-sep { width: 1px; height: 18px; background: #222; margin: 0 5px; }

    .page { max-width: 900px; margin: 0 auto; padding: 20px 16px 40px; }

    .form-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 15px; flex-wrap: wrap; gap: 10px;
    }
    .title-section {
      display: flex; align-items: center; gap: 10px;
    }
    .title-section h2 {
      font-size: 1rem; font-weight: 600; letter-spacing: 2px;
      text-transform: uppercase; color: #ddd;
    }
    .season-badge {
      background: #1e6b1e; color: #fff; font-size: .6rem;
      padding: 3px 8px; border-radius: 3px; font-weight: 600;
      letter-spacing: 0.5px;
    }
    .season-badge.new { background: #f59e0b; animation: pulse 2s infinite; }

    .controls {
      display: flex; gap: 8px; align-items: center;
    }
    .refresh-btn {
      background: #1a1a1a; border: 1px solid #333; color: #aaa;
      font-size: .7rem; padding: 5px 12px; border-radius: 4px;
      cursor: pointer; transition: all .15s;
    }
    .refresh-btn:hover { background: #242424; border-color: #555; color: #fff; }

    /* Leaderboard tÃ¡blÃ¡zat */
    .leaderboard-block { background:#111; border:1px solid #2a2a2a; border-radius:4px; overflow:hidden; margin-bottom: 20px; }
    .leaderboard-header-bar {
      background:#1e6b1e;
      display:grid;
      grid-template-columns: 26px 1fr 40px 60px 60px 60px;
      align-items:center; padding:7px 10px; gap:4px;
    }
    .leaderboard-header-bar span { font-size:.58rem; font-weight:700; color:#fff; text-transform:uppercase; letter-spacing:.2px; }
    .leaderboard-header-bar .h-right { text-align:right; }

    .lb-meta {
      background:#0f0f0f; border-bottom:1px solid #1e1e1e;
      padding:4px 10px; font-size:.6rem; color:#444;
      display:flex; justify-content:space-between; align-items:center;
    }
    .refresh-dot { width:5px; height:5px; border-radius:50%; background:#3d8b3d; display:inline-block; margin-right:4px; animation:pulse 2s infinite; }
    .lb-meta.loading .refresh-dot { background:#f59e0b; }
    .lb-meta.error   .refresh-dot { background:#e53935; }

    .leaderboard-body { background:#141414; }

    .lb-row {
      display:grid;
      grid-template-columns: 26px 1fr 40px 60px 60px 60px;
      align-items:center; padding:4px 10px; gap:4px;
      border-bottom:1px solid #1d1d1d; transition:background .12s;
    }
    .lb-row:last-child { border-bottom:none; }
    .lb-row:hover { background:#1c1c1c; }
    .lb-row.top3 { background:#162316; }
    .lb-row.top3:hover { background:#1c2b1c; }
    .lb-row.bottom3 { background:#1a1010; }
    .lb-row.bottom3:hover { background:#231414; }

    .col-pos { font-size:.7rem; font-weight:700; color:#666; text-align:center; }
    .lb-row.top3 .col-pos { color:#4caf50; }
    .lb-row.bottom3 .col-pos { color:#e53935; }

    .col-team { display:flex; align-items:center; gap:6px; }
    .team-logo { width:16px; height:16px; object-fit:contain; flex-shrink:0; }
    .team-name { font-size:.76rem; font-weight:600; color:#ccc; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .col-gf, .col-ga, .col-gd, .col-pts { 
      font-size:.7rem; 
      text-align:right; 
      font-variant-numeric:tabular-nums;
    }
    .col-gf { color:#aaa; }
    .col-ga { color:#aaa; }
    .col-gd { font-weight:600; }
    .col-pts { font-size:.8rem; font-weight:800; color:#fff; }

    .trend-up { color: #4caf50; margin-left: 3px; }
    .trend-down { color: #e53935; margin-left: 3px; }

    /* Statisztika kÃ¡rtyÃ¡k */
    .stats-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: #111; border: 1px solid #2a2a2a; border-radius: 4px;
      padding: 12px 10px; text-align: center;
    }
    .stat-label {
      font-size: .6rem; text-transform: uppercase; color: #666;
      letter-spacing: 1px; margin-bottom: 5px;
    }
    .stat-value {
      font-size: 1.2rem; font-weight: 700; color: #fff;
    }

    /* AI Panel */
    .aipanel {
      background: #111; border: 1px solid #2a2a2a; border-radius: 4px;
      overflow: hidden; margin-top: 20px;
    }
    .aipanel.show { display: block; }
    .aipanel-hdr {
      background: #1a1a1a; border-bottom: 1px solid #2a2a2a;
      padding: 10px 16px; display: flex; align-items: center; gap: 10px;
    }
    .aipanel-title {
      font-size: .8rem; font-weight: 600; letter-spacing: 1px;
      text-transform: uppercase; color: #ddd;
    }
    .ai-badge {
      font-size: .55rem; background: #333; color: #aaa;
      padding: 2px 6px; border-radius: 3px; letter-spacing: 1px;
    }
    .aibody {
      padding: 16px 20px; font-size: .82rem; line-height: 1.7;
      color: #ccc; min-height: 80px;
    }

    .dots { display: flex; gap: 5px; padding: 10px 0; }
    .dots span {
      width: 6px; height: 6px; border-radius: 50%; background: #4caf50;
      opacity: .4; animation: d 1s infinite;
    }
    .dots span:nth-child(2){ animation-delay:.2s; }
    .dots span:nth-child(3){ animation-delay:.4s; }
    @keyframes d { 0%,100%{opacity:.4} 50%{opacity:1} }

    .error-box {
      background: rgba(229, 57, 53, 0.1); border: 1px solid rgba(229, 57, 53, 0.2);
      border-radius: 4px; padding: 12px 16px; font-size: .78rem;
      color: #ff8a80; margin-bottom: 16px; display: none;
    }
    .error-box.show { display: block; }

    @media (max-width:560px) {
      .stats-grid { grid-template-columns: 1fr; }
      .leaderboard-header-bar { grid-template-columns: 26px 1fr 30px 45px 45px 45px; }
    }
  </style>
</head>
<body>

<header>
  <a class="back-btn" href="/">â† Vissza</a>
  <div class="header-sep"></div>
  <div class="dot"></div>
  <h1>VSPORT &mdash; TeljesÃ­tmÃ©ny & Forma</h1>
</header>

<div class="page">
  <div class="form-header">
    <div class="title-section">
      <h2>âš¡ Ã‰lÅ‘ TeljesÃ­tmÃ©nytÃ¡bla</h2>
      <span class="season-badge" id="seasonBadge">Premier Liga</span>
    </div>
    <div class="controls">
      <button class="refresh-btn" id="refreshBtn">ğŸ”„ FrissÃ­tÃ©s</button>
    </div>
  </div>

  <!-- Gyors statisztikÃ¡k -->
  <div class="stats-grid" id="statsGrid">
    <div class="stat-card">
      <div class="stat-label">LegtÃ¶bb pont</div>
      <div class="stat-value" id="bestTeamStat">â€“</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Legjobb gÃ³lkÃ¼lÃ¶nbsÃ©g</div>
      <div class="stat-value" id="bestGDStat">â€“</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Csapatok szÃ¡ma</div>
      <div class="stat-value" id="teamsCountStat">â€“</div>
    </div>
  </div>

  <!-- TeljesÃ­tmÃ©ny tÃ¡blÃ¡zat -->
  <div class="leaderboard-block">
    <div class="leaderboard-header-bar">
      <span>#</span>
      <span>Csapat</span>
      <span class="h-right">L</span>
      <span class="h-right">K</span>
      <span class="h-right">GK</span>
      <span class="h-right">P</span>
    </div>
    <div class="lb-meta loading" id="formMeta">
      <span><span class="refresh-dot"></span>Adatok betÃ¶ltÃ©se...</span>
      <span id="updateTime">â€“</span>
    </div>
    <div class="leaderboard-body" id="formTable">
      <div style="padding:8px 10px">
        <div style="height:20px; background:#1a1a1a; border-radius:3px; margin-bottom:5px;"></div>
        <div style="height:20px; background:#1a1a1a; border-radius:3px; margin-bottom:5px;"></div>
        <div style="height:20px; background:#1a1a1a; border-radius:3px;"></div>
      </div>
    </div>
  </div>

  <!-- AI ElemzÃ©s panel -->
  <div class="aipanel" id="aiPanel">
    <div class="aipanel-hdr">
      <span class="aipanel-title">ğŸ“Š AI TeljesÃ­tmÃ©ny ElemzÃ©s</span>
      <span class="ai-badge">gemini-2.5-flash</span>
    </div>
    <div class="aibody" id="aiBody">
      <div class="dots"><span></span><span></span><span></span></div>
    </div>
  </div>

  <div class="error-box" id="errorBox"></div>
</div>

<script>
// FIGYELEM: Ez a kulcs nem mÅ±kÃ¶dik! CserÃ©ld ki a sajÃ¡t API kulcsodra!
const GEMINI_KEY = 'AIzaSyD6tfnMdM2_FdYjL6QQuXYjq7BVkfUvizg';

// State
let currentStandings = [];
let previousStandings = []; // Az elÅ‘zÅ‘ Ã¡llapot a trendekhez
let currentSeason = 1;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1. Standings betÃ¶ltÃ©se az API-bÃ³l
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchStandings() {
  const response = await fetch('/api/standings?liga=pl');
  if (!response.ok) throw new Error(`API hiba: ${response.status}`);
  
  const data = await response.json();
  return data.standings || [];
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 2. Trendek szÃ¡mÃ­tÃ¡sa (elÅ‘zÅ‘ Ã¡llapothoz kÃ©pest)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calculateTrends(current, previous) {
  if (!previous || previous.length === 0) return current;
  
  const previousMap = new Map(previous.map(t => [t.team, t]));
  
  return current.map(team => {
    const prev = previousMap.get(team.team);
    if (!prev) return { ...team, trend: 'same' };
    
    if (team.pos < prev.pos) return { ...team, trend: 'up' };
    if (team.pos > prev.pos) return { ...team, trend: 'down' };
    return { ...team, trend: 'same' };
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 3. SzezonvÃ¡ltÃ¡s detektÃ¡lÃ¡s
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function detectNewSeason(newStandings) {
  if (!newStandings || newStandings.length === 0) return false;
  
  // Ha minden csapat pontja 0 vagy nagyon alacsony
  const allZero = newStandings.every(team => team.pts === 0 || team.pts < 3);
  const wasPositive = previousStandings.some(team => team.pts > 10);
  
  if (allZero && wasPositive) {
    currentSeason++;
    document.getElementById('seasonBadge').textContent = `ğŸ¯ Ãšj szezon (${currentSeason})`;
    document.getElementById('seasonBadge').classList.add('new');
    return true;
  }
  
  document.getElementById('seasonBadge').textContent = `Premier Liga (${currentSeason}. szezon)`;
  document.getElementById('seasonBadge').classList.remove('new');
  return false;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 4. UI frissÃ­tÃ©s
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTable(standings) {
  const table = document.getElementById('formTable');
  const meta = document.getElementById('formMeta');
  const updateTime = document.getElementById('updateTime');
  
  if (!standings || standings.length === 0) {
    table.innerHTML = '<div style="padding:20px;text-align:center;color:#555">Nincs adat</div>';
    return;
  }
  
  const html = standings.map(team => {
    const rowClass = team.pos <= 3 ? 'lb-row top3' : 
                     team.pos >= standings.length - 2 ? 'lb-row bottom3' : 'lb-row';
    
    const gd = (team.goalsFor || 0) - (team.goalsAgainst || 0);
    const gdColor = gd > 0 ? '#4caf50' : gd < 0 ? '#e53935' : '#666';
    
    const trendIcon = team.trend === 'up' ? '<span class="trend-up">â–²</span>' :
                      team.trend === 'down' ? '<span class="trend-down">â–¼</span>' : '';
    
    return `
      <div class="${rowClass}">
        <span class="col-pos">${team.pos}</span>
        <span class="col-team">
          ${team.logo ? `<img class="team-logo" src="${team.logo}" onerror="this.style.display='none'">` : ''}
          <span class="team-name">${team.team}</span>
          ${trendIcon}
        </span>
        <span class="col-gf">${team.goalsFor || 0}</span>
        <span class="col-ga">${team.goalsAgainst || 0}</span>
        <span class="col-gd" style="color:${gdColor}">${gd > 0 ? '+' + gd : gd}</span>
        <span class="col-pts">${team.pts || 0}</span>
      </div>
    `;
  }).join('');
  
  table.innerHTML = html;
  meta.className = 'lb-meta';
  meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>Ã‰lÅ‘ teljesÃ­tmÃ©ny';
  updateTime.textContent = new Date().toLocaleTimeString('hu-HU');
  
  // StatisztikÃ¡k
  if (standings.length > 0) {
    document.getElementById('bestTeamStat').textContent = standings[0].team;
    
    const bestGD = standings.reduce((best, team) => {
      const gd = (team.goalsFor || 0) - (team.goalsAgainst || 0);
      return gd > best.gd ? { team: team.team, gd } : best;
    }, { team: '-', gd: -999 });
    
    document.getElementById('bestGDStat').innerHTML = `${bestGD.team} <span style="font-size:.7rem">(${bestGD.gd > 0 ? '+' + bestGD.gd : bestGD.gd})</span>`;
    document.getElementById('teamsCountStat').textContent = standings.length;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 5. AI elemzÃ©s - Gemini 2.5 Flash
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateAnalysis(standings) {
  const body = document.getElementById('aiBody');
  const panel = document.getElementById('aiPanel');
  const errorBox = document.getElementById('errorBox');
  
  panel.classList.add('show');
  errorBox.classList.remove('show');
  body.innerHTML = '<div class="dots"><span></span><span></span><span></span></div>';
  
  // API kulcs ellenÅ‘rzÃ©s
  if (!GEMINI_KEY || GEMINI_KEY === 'AIzaSyD7j_N6YgsaeOapaLznrRAKtrnUWYvBZro' || GEMINI_KEY.includes('YOUR_KEY')) {
    body.innerHTML = '<div style="color:#f59e0b; padding:10px">âš ï¸ Gemini API kulcs beÃ¡llÃ­tÃ¡sa szÃ¼ksÃ©ges!<br><br>A tippek.html fÃ¡jlban cserÃ©ld ki a GEMINI_KEY Ã©rtÃ©kÃ©t a sajÃ¡t API kulcsodra.</div>';
    return;
  }
  
  const top3 = standings.slice(0, 3);
  const bottom3 = standings.slice(-3);
  
  const top3Text = top3.map(t => {
    const gd = (t.goalsFor || 0) - (t.goalsAgainst || 0);
    return `  â€¢ ${t.pos}. **${t.team}** â€“ ${t.pts} pont (${t.goalsFor || 0}:${t.goalsAgainst || 0}, ${gd > 0 ? '+' + gd : gd})`;
  }).join('\n');
  
  const bottom3Text = bottom3.map(t => {
    const gd = (t.goalsFor || 0) - (t.goalsAgainst || 0);
    return `  â€¢ ${t.pos}. **${t.team}** â€“ ${t.pts} pont (${t.goalsFor || 0}:${t.goalsAgainst || 0}, ${gd})`;
  }).join('\n');
  
  // Trendek kiszÃ¡molÃ¡sa
  const upTeams = standings.filter(t => t.trend === 'up').slice(0, 3);
  const downTeams = standings.filter(t => t.trend === 'down').slice(0, 3);
  
  // PontÃ¡tlagok
  const avgPts = (standings.reduce((sum, t) => sum + (t.pts || 0), 0) / standings.length).toFixed(1);
  
  const prompt = `Te egy VirtuÃ¡lis LabdarÃºgÃ¡s Liga (Premier Liga) profi elemzÅ‘je vagy.
Elemezd a tabella alapjÃ¡n a csapatok teljesÃ­tmÃ©nyÃ©t!

AKTUÃLIS ÃLLÃS (top 3):
${top3Text}

UTOLSÃ“ 3 HELYEZETT:
${bottom3Text}

${upTeams.length > 0 ? 'FELFELÃ‰ MOZGÃ“K (javulÃ³ pozÃ­ciÃ³):\n' + upTeams.map(t => `  â€¢ **${t.team}** (${t.pos}. hely, ${t.trend === 'up' ? 'â–²' : ''})`).join('\n') : ''}
${downTeams.length > 0 ? 'LEFELÃ‰ MOZGÃ“K (romlÃ³ pozÃ­ciÃ³):\n' + downTeams.map(t => `  â€¢ **${t.team}** (${t.pos}. hely, ${t.trend === 'down' ? 'â–¼' : ''})`).join('\n') : ''}

ÃTLAGOS PONTSZÃM: ${avgPts} pont/csapat

KÃ©rlek adj egy rÃ¶vid, velÅ‘s elemzÃ©st:
ğŸ”¥ **KI A FAVORIT?** â€“ Ki tÅ±nik bajnokesÃ©lyesnek?
ğŸ“ˆ **KI A MEGLEPETÃ‰S?** â€“ Ki teljesÃ­t vÃ¡ratlanul jÃ³l?
ğŸ“‰ **KI A CSALÃ“DÃS?** â€“ Ki van elmaradva?
âš¡ **KÃœZDELEM** â€“ Hol a legszorosabb a mezÅ‘ny?
ğŸ¯ **TIPP** â€“ Egy rÃ¶vid jÃ³slat

VÃ¡laszolj MAGYARUL, max 150 szÃ³! HasznÃ¡lj fÃ©lkÃ¶vÃ©r csapatneveket.`;
  
  try {
    // Gemini 2.5 Flash endpoint
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_KEY}`,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [{
            parts: [{ text: prompt }]
          }],
          generationConfig: {
            temperature: 0.7,
            maxOutputTokens: 300,
          }
        })
      }
    );
    
    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      console.error('Gemini API hiba:', errorData);
      
      // Specifikus hibaÃ¼zenetek
      if (response.status === 403) {
        throw new Error('API kulcs Ã©rvÃ©nytelen vagy letiltva. EllenÅ‘rizd a GEMINI_KEY Ã©rtÃ©kÃ©t!');
      } else if (response.status === 429) {
        throw new Error('TÃºl sok kÃ©rÃ©s - vÃ¡rj egy kicsit');
      } else {
        throw new Error(`Gemini API hiba (${response.status})`);
      }
    }
    
    const data = await response.json();
    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
    
    if (!text) {
      throw new Error('Az AI nem adott vÃ¡laszt');
    }
    
    body.innerHTML = formatAnalysis(text);
    
  } catch (error) {
    console.error('AI elemzÃ©s hiba:', error);
    errorBox.textContent = `âš ï¸ ${error.message}`;
    errorBox.classList.add('show');
    body.innerHTML = '<div style="color:#666">ElemzÃ©s nem elÃ©rhetÅ‘</div>';
  }
}

function formatAnalysis(text) {
  return text
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/^#{1,3}\s*(.+)$/gm, '<h3 style="margin:12px 0 6px;color:#4caf50;font-size:.85rem">$1</h3>')
    .replace(/\n\n/g, '</p><p>')
    .replace(/\n/g, '<br>')
    .replace(/^<br>|<br>$/g, '');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 6. FÅ‘ betÃ¶ltÅ‘ fÃ¼ggvÃ©ny
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadData() {
  const meta = document.getElementById('formMeta');
  
  meta.className = 'lb-meta loading';
  meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>BetÃ¶ltÃ©s...';
  
  try {
    const newStandings = await fetchStandings();
    
    if (newStandings.length === 0) {
      throw new Error('Nincs adat');
    }
    
    // SzezonvÃ¡ltÃ¡s detektÃ¡lÃ¡s
    detectNewSeason(newStandings);
    
    // Trendek szÃ¡mÃ­tÃ¡sa (elÅ‘zÅ‘ Ã¡llapothoz kÃ©pest)
    const standingsWithTrends = calculateTrends(newStandings, previousStandings);
    
    // TÃ¡blÃ¡zat renderelÃ©s
    renderTable(standingsWithTrends);
    
    // AI elemzÃ©s
    await generateAnalysis(standingsWithTrends);
    
    // ElmentjÃ¼k az elÅ‘zÅ‘ Ã¡llapotot
    previousStandings = newStandings;
    
  } catch(e) {
    const errorBox = document.getElementById('errorBox');
    errorBox.textContent = `âŒ ${e.message}`;
    errorBox.classList.add('show');
    
    meta.className = 'lb-meta error';
    meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>Hiba';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// InicializÃ¡lÃ¡s
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  loadData();
  
  document.getElementById('refreshBtn').addEventListener('click', loadData);
  
  // Automatikus frissÃ­tÃ©s 30 mÃ¡sodpercenkÃ©nt
  setInterval(loadData, 30000);
});
</script>

</body>
</html>
