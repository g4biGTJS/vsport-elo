<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VSPORT – AI Tabella & Tippek</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#030507;--surface:#070c10;--surface2:#0b1218;--surface3:#0f1820;
      --border:#0e1e28;--border2:#162535;
      --text:#d4e8f0;--text-dim:#4a7a99;--text-muted:#1e3d52;
      --green:#00e676;--green2:#00c853;--red:#ff3d3d;--amber:#ffab00;--cyan:#00b8d4;
    }
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    html,body{background:var(--bg);color:var(--text);font-family:'Barlow',sans-serif;min-height:100vh;overflow-x:hidden;}

    .bg-layer{position:fixed;inset:0;z-index:0;pointer-events:none;}
    .bg-mesh{background:radial-gradient(ellipse 80% 60% at 20% 30%,rgba(0,80,40,0.18) 0%,transparent 60%),radial-gradient(ellipse 60% 80% at 80% 70%,rgba(0,40,80,0.2) 0%,transparent 60%),radial-gradient(ellipse 100% 40% at 50% 100%,rgba(0,100,60,0.12) 0%,transparent 50%),#030507;animation:meshShift 12s ease-in-out infinite alternate;}
    @keyframes meshShift{0%{background-position:0% 0%,100% 100%,50% 100%}50%{background-position:10% 20%,80% 80%,60% 90%}100%{background-position:20% 5%,70% 90%,50% 80%}}
    .bg-orbs{overflow:hidden;}
    .orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:1;animation:orbFloat linear infinite;}
    .orb1{width:500px;height:500px;background:radial-gradient(circle,rgba(0,180,80,0.12) 0%,transparent 70%);top:-100px;left:-100px;animation-duration:25s;}
    .orb2{width:400px;height:400px;background:radial-gradient(circle,rgba(0,100,200,0.1) 0%,transparent 70%);top:30%;right:-80px;animation-duration:30s;animation-delay:-8s;}
    .orb3{width:350px;height:350px;background:radial-gradient(circle,rgba(0,220,100,0.08) 0%,transparent 70%);bottom:10%;left:30%;animation-duration:20s;animation-delay:-15s;}
    @keyframes orbFloat{0%{transform:translate(0,0) scale(1)}25%{transform:translate(40px,-30px) scale(1.1)}50%{transform:translate(-20px,50px) scale(0.95)}75%{transform:translate(30px,20px) scale(1.05)}100%{transform:translate(0,0) scale(1)}}
    .bg-grid{background-image:linear-gradient(rgba(0,180,100,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,180,100,0.025) 1px,transparent 1px);background-size:60px 60px;animation:gridSlide 20s linear infinite;}
    @keyframes gridSlide{0%{background-position:0 0}100%{background-position:60px 60px}}
    .bg-scan{background:linear-gradient(to bottom,transparent 49.9%,rgba(0,230,118,0.03) 50%,transparent 50.1%);background-size:100% 8px;animation:scanMove 3s linear infinite;}
    @keyframes scanMove{0%{background-position:0 0}100%{background-position:0 8px}}
    .bg-noise{opacity:.035;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");background-size:256px;animation:grainAnim .4s steps(1) infinite;}
    @keyframes grainAnim{0%{transform:translate(0,0)}10%{transform:translate(-3%,-2%)}20%{transform:translate(3%,2%)}30%{transform:translate(-2%,3%)}40%{transform:translate(2%,-3%)}50%{transform:translate(-3%,2%)}60%{transform:translate(3%,-2%)}70%{transform:translate(-2%,-3%)}80%{transform:translate(2%,3%)}90%{transform:translate(-3%,3%)}100%{transform:translate(3%,-1%)}}
    .bg-vignette{background:radial-gradient(ellipse 100% 100% at 50% 50%,transparent 40%,rgba(0,0,0,0.7) 100%);}
    #particleCanvas{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.5;}

    header{position:sticky;top:0;z-index:100;background:rgba(3,5,7,0.88);backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid rgba(0,230,118,0.1);padding:0 28px;height:58px;display:flex;align-items:center;gap:16px;box-shadow:0 4px 32px rgba(0,0,0,0.6);}
    header::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(0,230,118,0.4) 30%,rgba(0,230,118,0.8) 50%,rgba(0,230,118,0.4) 70%,transparent 100%);background-size:200% 100%;animation:lineSlide 4s linear infinite;}
    @keyframes lineSlide{0%{background-position:200% 0}100%{background-position:-200% 0}}

    .header-left{display:flex;align-items:center;gap:14px;animation:slideL .7s cubic-bezier(.16,1,.3,1) both;}
    .header-right{margin-left:auto;animation:slideR .7s cubic-bezier(.16,1,.3,1) .1s both;}
    @keyframes slideL{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
    @keyframes slideR{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}

    .live-pulse-wrap{position:relative;display:flex;align-items:center;justify-content:center;width:28px;height:28px;}
    .live-pulse-ring{position:absolute;width:28px;height:28px;border-radius:50%;border:1px solid rgba(0,230,118,0.4);animation:ringPulse 2s ease-out infinite;}
    .live-pulse-ring:nth-child(2){animation-delay:.5s;}
    @keyframes ringPulse{0%{transform:scale(.5);opacity:1}100%{transform:scale(1.4);opacity:0}}
    .live-dot-core{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 12px var(--green),0 0 24px rgba(0,230,118,0.4);position:relative;z-index:1;animation:corePulse 2s ease-in-out infinite;}
    @keyframes corePulse{0%,100%{box-shadow:0 0 8px var(--green),0 0 16px rgba(0,230,118,0.3)}50%{box-shadow:0 0 16px var(--green),0 0 32px rgba(0,230,118,0.6)}}

    .site-title{font-family:'Barlow Condensed',sans-serif;font-size:1.8rem;font-weight:900;letter-spacing:6px;color:#fff;text-transform:uppercase;text-shadow:0 0 30px rgba(255,255,255,0.2);position:relative;}
    .site-title::before,.site-title::after{content:'VSPORT';position:absolute;left:0;top:0;opacity:0;}
    .site-title::before{color:var(--green);animation:g1 8s infinite;clip-path:polygon(0 30%,100% 30%,100% 50%,0 50%);}
    .site-title::after{color:var(--cyan);animation:g2 8s infinite;clip-path:polygon(0 60%,100% 60%,100% 80%,0 80%);}
    @keyframes g1{0%,92%,100%{opacity:0;transform:none}93%{opacity:.7;transform:translate(-2px,0)}94%{opacity:0}96%{opacity:.5;transform:translate(2px,0)}97%{opacity:0}}
    @keyframes g2{0%,93%,100%{opacity:0;transform:none}94%{opacity:.5;transform:translate(2px,1px)}95%{opacity:0}97%{opacity:.4;transform:translate(-2px,0)}98%{opacity:0}}

    .header-sep{width:1px;height:24px;background:linear-gradient(to bottom,transparent,var(--border2),transparent);}

    .back-btn{display:flex;align-items:center;gap:8px;color:var(--text-dim);font-family:'JetBrains Mono',monospace;font-size:.58rem;text-decoration:none;letter-spacing:1.5px;padding:6px 14px;border:1px solid rgba(0,230,118,0.15);border-radius:2px;transition:all .25s;background:rgba(0,230,118,0.04);}
    .back-btn:hover{color:var(--green);border-color:rgba(0,230,118,0.4);box-shadow:0 0 16px rgba(0,230,118,0.1);}

    .ai-header-badge{display:flex;align-items:center;gap:8px;background:rgba(0,230,118,0.08);border:1px solid rgba(0,230,118,0.2);border-radius:2px;padding:5px 14px;font-family:'JetBrains Mono',monospace;font-size:.58rem;letter-spacing:2px;color:var(--green);box-shadow:0 0 16px rgba(0,230,118,0.08);}
    .ai-badge-dot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:corePulse 1.5s infinite;}

    .page{position:relative;z-index:1;max-width:960px;margin:0 auto;padding:32px 20px 80px;animation:pageUp .6s cubic-bezier(.16,1,.3,1) .1s both;}
    @keyframes pageUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    .tabs{display:flex;margin-bottom:28px;border-bottom:1px solid rgba(0,230,118,0.08);gap:4px;}
    .tab{background:none;border:none;border-bottom:2px solid transparent;color:var(--text-dim);font-family:'JetBrains Mono',monospace;font-size:.6rem;letter-spacing:2px;padding:10px 22px;cursor:pointer;transition:all .2s;text-transform:uppercase;display:flex;align-items:center;gap:8px;position:relative;top:1px;}
    .tab:hover{color:rgba(0,230,118,0.7);}
    .tab.active{color:var(--green);border-bottom-color:var(--green);text-shadow:0 0 12px rgba(0,230,118,0.4);}
    .tab-icon{width:14px;height:14px;}

    .section-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
    .section-title{font-family:'Barlow Condensed',sans-serif;font-size:1.4rem;font-weight:800;letter-spacing:4px;color:var(--text);display:flex;align-items:center;gap:12px;text-transform:uppercase;}
    .section-title-icon{width:18px;height:18px;opacity:.9;}
    .season-badge{background:rgba(0,230,118,0.15);border:1px solid rgba(0,230,118,0.3);color:var(--green);font-size:.6rem;padding:2px 8px;border-radius:12px;margin-left:8px;}

    .ai-badge-pill{background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.25);color:var(--green);font-size:.52rem;font-family:'JetBrains Mono',monospace;padding:3px 10px;border-radius:2px;letter-spacing:1.5px;box-shadow:0 0 12px rgba(0,230,118,0.1);animation:corePulse 2s infinite;}

    .btn{display:flex;align-items:center;gap:8px;background:linear-gradient(135deg,var(--surface2),var(--surface3));border:1px solid var(--border2);color:var(--text-dim);font-size:.6rem;font-family:'JetBrains Mono',monospace;letter-spacing:1.5px;padding:8px 16px;border-radius:2px;cursor:pointer;transition:all .2s;text-transform:uppercase;}
    .btn:hover{background:rgba(0,230,118,0.06);border-color:rgba(0,230,118,0.3);color:var(--green);box-shadow:0 0 20px rgba(0,230,118,0.1);}
    .btn-icon{width:13px;height:13px;}

    .season-notice{display:flex;align-items:center;gap:10px;background:rgba(255,171,0,0.06);border:1px solid rgba(255,171,0,0.2);border-radius:2px;padding:10px 14px;margin-bottom:16px;font-size:.68rem;color:var(--amber);font-family:'JetBrains Mono',monospace;}

    .leaderboard-block{background:var(--surface);border:1px solid var(--border);border-radius:3px;overflow:hidden;margin-bottom:16px;position:relative;}
    .leaderboard-block::before{content:'';position:absolute;top:0;left:0;width:40px;height:40px;border-top:2px solid rgba(0,230,118,0.2);border-left:2px solid rgba(0,230,118,0.2);pointer-events:none;z-index:2;}

    .leaderboard-header-bar{background:linear-gradient(90deg,rgba(0,50,25,0.9) 0%,rgba(0,80,40,0.6) 50%,rgba(0,50,25,0.3) 100%);display:grid;grid-template-columns:28px 18px 1fr 80px 46px 38px;align-items:center;padding:8px 12px;gap:4px;border-bottom:1px solid rgba(0,230,118,0.12);position:relative;}
    .leaderboard-header-bar::after{content:'';position:absolute;bottom:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(0,230,118,0.4),transparent);}
    .leaderboard-header-bar span{font-family:'JetBrains Mono',monospace;font-size:.52rem;font-weight:700;color:rgba(0,230,118,0.65);text-transform:uppercase;letter-spacing:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .leaderboard-header-bar .h-right{text-align:right;}

    .matches-header-bar{background:linear-gradient(90deg,rgba(0,50,25,0.9) 0%,rgba(0,80,40,0.6) 50%,rgba(0,50,25,0.3) 100%);display:grid;grid-template-columns:40px 60px 1fr 40px 1fr;align-items:center;padding:8px 12px;gap:4px;border-bottom:1px solid rgba(0,230,118,0.12);position:relative;}
    .matches-header-bar::after{content:'';position:absolute;bottom:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(0,230,118,0.4),transparent);}
    .matches-header-bar span{font-family:'JetBrains Mono',monospace;font-size:.52rem;font-weight:700;color:rgba(0,230,118,0.65);text-transform:uppercase;letter-spacing:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    .lb-meta{background:rgba(0,0,0,0.4);border-bottom:1px solid var(--border);padding:4px 12px;font-size:.56rem;color:var(--text-muted);display:flex;justify-content:space-between;align-items:center;font-family:'JetBrains Mono',monospace;}
    .refresh-dot{width:5px;height:5px;border-radius:50%;background:var(--green);display:inline-block;margin-right:5px;animation:corePulse 2s infinite;}
    .lb-meta.loading .refresh-dot{background:var(--amber);box-shadow:0 0 6px rgba(255,171,0,0.4);}
    .lb-meta.error .refresh-dot{background:var(--red);}

    .leaderboard-body{background:var(--surface);}

    .lb-row{display:grid;grid-template-columns:28px 18px 1fr 80px 46px 38px;align-items:center;padding:5px 12px;gap:4px;border-bottom:1px solid var(--border);transition:background .15s,transform .15s;animation:rowSlide .4s ease both;position:relative;}
    .lb-row:last-child{border-bottom:none;}
    .lb-row::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;opacity:0;transition:opacity .15s;}
    .lb-row:hover::before{opacity:1;}
    .lb-row:hover{background:var(--surface2);transform:translateX(2px);}

    .match-row{display:grid;grid-template-columns:40px 60px 1fr 40px 1fr;align-items:center;padding:8px 12px;gap:4px;border-bottom:1px solid var(--border);transition:background .15s;animation:rowSlide .4s ease both;}
    .match-row:last-child{border-bottom:none;}
    .match-row:hover{background:var(--surface2);}
    .match-round{font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--cyan);}
    .match-time{font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--amber);}
    .match-team{display:flex;align-items:center;gap:6px;font-size:.75rem;color:#aac5d4;}
    .match-team-logo{width:16px;height:16px;object-fit:contain;}
    .match-vs{text-align:center;color:var(--text-dim);font-size:.6rem;}

    @keyframes rowSlide{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:translateX(0)}}

    .lb-row.top3{background:linear-gradient(90deg,rgba(0,100,45,0.15) 0%,transparent 100%);}
    .lb-row.top3::before{background:var(--green);}
    .lb-row.top3:hover{background:rgba(0,100,45,0.2);}
    .lb-row.relegation{background:linear-gradient(90deg,rgba(255,61,61,0.07) 0%,transparent 100%);}
    .lb-row.relegation::before{background:var(--red);}
    .lb-row.relegation:hover{background:rgba(255,61,61,0.1);}

    .col-pos{font-family:'JetBrains Mono',monospace;font-size:.68rem;font-weight:700;color:var(--text-dim);text-align:center;}
    .lb-row.top3 .col-pos{color:var(--green);text-shadow:0 0 8px rgba(0,230,118,0.4);}
    .lb-row.relegation .col-pos{color:var(--red);}
    .col-trend{display:flex;align-items:center;justify-content:center;}
    .trend-up{color:var(--green);font-size:.5rem;filter:drop-shadow(0 0 4px rgba(0,230,118,0.6));}
    .trend-down{color:var(--red);font-size:.5rem;filter:drop-shadow(0 0 4px rgba(255,61,61,0.6));}
    .trend-same{color:#1a2e3d;font-size:.5rem;}
    .col-team{display:flex;align-items:center;gap:7px;min-width:0;}
    .team-logo{width:16px;height:16px;object-fit:contain;flex-shrink:0;}
    .team-logo-placeholder{width:16px;height:16px;flex-shrink:0;background:rgba(0,230,118,0.1);border-radius:50%;}
    .team-name{font-size:.74rem;font-weight:600;color:#aac5d4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .lb-row.top3 .team-name{color:var(--text);}
    .col-goals{font-family:'JetBrains Mono',monospace;font-size:.62rem;color:var(--text-dim);text-align:right;}
    .col-gd{font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--text-muted);text-align:right;}
    .col-pts{font-family:'JetBrains Mono',monospace;font-size:.8rem;font-weight:700;color:#fff;text-align:right;text-shadow:0 0 12px rgba(255,255,255,0.15);}
    .lb-row.top3 .col-pts{color:var(--green);text-shadow:0 0 12px rgba(0,230,118,0.4);}

    .aipanel{background:var(--surface);border:1px solid rgba(0,230,118,0.1);border-radius:3px;overflow:hidden;margin-top:16px;animation:rowSlide .5s ease both;position:relative;}
    .aipanel::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(0,230,118,0.5),transparent);}
    .aipanel-hdr{background:linear-gradient(90deg,rgba(0,50,25,0.7),rgba(0,20,10,0.5));border-bottom:1px solid rgba(0,230,118,0.08);padding:10px 16px;display:flex;align-items:center;gap:10px;}
    .aipanel-title{font-family:'Barlow Condensed',sans-serif;font-size:.9rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--text);}
    .aibody{padding:18px 20px;font-size:.84rem;line-height:1.9;color:var(--text-dim);min-height:80px;}

    .dots{display:flex;gap:6px;padding:20px 0;justify-content:center;}
    .dots span{width:6px;height:6px;border-radius:50%;background:var(--green);opacity:.15;animation:dotPulse 1.2s infinite;}
    .dots span:nth-child(2){animation-delay:.2s;}.dots span:nth-child(3){animation-delay:.4s;}
    @keyframes dotPulse{0%,100%{opacity:.15}50%{opacity:.9;box-shadow:0 0 8px var(--green)}}

    .error-box{display:none;background:rgba(255,61,61,0.06);border:1px solid rgba(255,61,61,0.2);border-radius:2px;padding:12px 16px;font-size:.72rem;color:#ff8a80;margin-bottom:16px;font-family:'JetBrains Mono',monospace;}
    .error-box.show{display:flex;align-items:center;gap:8px;}

    .footer-line{position:fixed;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent 0%,rgba(0,230,118,0.2) 20%,rgba(0,230,118,0.6) 50%,rgba(0,230,118,0.2) 80%,transparent 100%);z-index:50;}
  </style>
</head>
<body>

<div class="bg-layer bg-mesh"></div>
<div class="bg-layer bg-orbs"><div class="orb orb1"></div><div class="orb orb2"></div><div class="orb orb3"></div></div>
<div class="bg-layer bg-grid"></div>
<div class="bg-layer bg-scan"></div>
<div class="bg-layer bg-noise"></div>
<div class="bg-layer bg-vignette"></div>
<canvas id="particleCanvas"></canvas>
<div class="footer-line"></div>

<header>
  <div class="header-left">
    <div class="live-pulse-wrap">
      <div class="live-pulse-ring"></div>
      <div class="live-pulse-ring"></div>
      <div class="live-dot-core"></div>
    </div>
    <div class="header-sep"></div>
    <span class="site-title">VSPORT</span>
    <div class="header-sep"></div>
    <a class="back-btn" href="/">
      <svg style="width:11px;height:11px" viewBox="0 0 24 24" fill="none"><path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Vissza
    </a>
  </div>
  <div class="header-right">
    <div class="ai-header-badge">
      <div class="ai-badge-dot"></div>
      AI Elemző
    </div>
  </div>
</header>

<div class="page">
  <div class="tabs">
    <button class="tab active" id="realTab" onclick="showTab('real')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none"><path d="M3 3v18h18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M7 16l4-4 4 4 4-7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Valós Tabella
    </button>
    <button class="tab" id="aiTab" onclick="showTab('ai')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none"><path d="M12 2L13.5 8.5L20 10L13.5 11.5L12 18L10.5 11.5L4 10L10.5 8.5L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
      AI Tabella
    </button>
    <button class="tab" id="matchesTab" onclick="showTab('matches')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none"><path d="M4 5h16v14H4V5z" stroke="currentColor" stroke-width="1.5"/><path d="M8 3v4M16 3v4" stroke="currentColor" stroke-width="1.5"/><path d="M4 10h16" stroke="currentColor" stroke-width="1.5"/></svg>
      Következő Meccsek
    </button>
  </div>

  <!-- VALÓS TABELLA -->
  <div id="realContainer">
    <div class="section-hdr">
      <div class="section-title">
        <svg class="section-title-icon" viewBox="0 0 24 24" fill="none"><path d="M13 2L4.5 13.5H11L10 22L19.5 10.5H13L13 2Z" fill="currentColor" stroke="currentColor" stroke-width="0.5" stroke-linejoin="round"/></svg>
        Premier Liga
        <span class="season-badge" id="seasonBadgeReal"></span>
      </div>
      <button class="btn" id="refreshRealBtn">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="none"><path d="M1 4v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Frissítés
      </button>
    </div>
    <div class="leaderboard-block">
      <div class="leaderboard-header-bar">
        <span>#</span><span></span><span>Csapat</span>
        <span class="h-right">Lőtt–Kapott</span><span class="h-right">GD</span><span class="h-right">Pont</span>
      </div>
      <div class="lb-meta loading" id="realMeta">
        <span><span class="refresh-dot"></span>Betöltés...</span>
        <span id="realUpdateTime">–</span>
      </div>
      <div class="leaderboard-body" id="realTable">
        <div style="padding:24px;text-align:center;color:var(--text-muted);font-size:.7rem;font-family:'JetBrains Mono',monospace">Betöltés...</div>
      </div>
    </div>
  </div>

  <!-- AI TABELLA -->
  <div id="aiContainer" style="display:none">
    <div class="section-hdr">
      <div class="section-title">
        <svg class="section-title-icon" viewBox="0 0 24 24" fill="none"><path d="M12 2L13.5 8.5L20 10L13.5 11.5L12 18L10.5 11.5L4 10L10.5 8.5L12 2Z" fill="currentColor" stroke="currentColor" stroke-width="0.5"/></svg>
        AI Előrejelzés
        <span class="ai-badge-pill">LLM7</span>
      </div>
      <button class="btn" id="generateAIBtn">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="none"><path d="M12 2L13.5 8.5L20 10L13.5 11.5L12 18L10.5 11.5L4 10L10.5 8.5L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
        Generálás
      </button>
    </div>
    <div class="season-notice" id="seasonNotice" style="display:none">
      <svg style="width:14px;height:14px;flex-shrink:0" viewBox="0 0 24 24" fill="none"><path d="M12 9v4m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      <span id="seasonNoticeText">Új szezon érzékelve</span>
    </div>
    <div class="leaderboard-block">
      <div class="leaderboard-header-bar">
        <span>#</span><span></span><span>Csapat</span>
        <span class="h-right">Lőtt–Kapott</span><span class="h-right">GD</span><span class="h-right">Pont</span>
      </div>
      <div class="lb-meta" id="aiMeta">
        <span><span class="refresh-dot"></span>AI becslés</span>
        <span id="aiUpdateTime">–</span>
      </div>
      <div class="leaderboard-body" id="aiTable">
        <div style="padding:36px;text-align:center;color:var(--text-muted);font-size:.7rem;font-family:'JetBrains Mono',monospace;line-height:2.2">
          Kattints a "Generálás" gombra<br>
          <span style="color:#0e1e28;font-size:.58rem">Az AI elemzi a valós adatokat és előrejelzést készít</span>
        </div>
      </div>
    </div>
    <div class="aipanel" id="aiPanel" style="display:none">
      <div class="aipanel-hdr">
        <svg style="width:16px;height:16px" viewBox="0 0 24 24" fill="none"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z" stroke="var(--green)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span class="aipanel-title">AI Elemzés</span>
        <span class="ai-badge-pill" style="margin-left:auto">llm7.io</span>
      </div>
      <div class="aibody" id="aiBody"></div>
    </div>
  </div>

  <!-- KÖVETKEZŐ MECCSEK -->
  <div id="matchesContainer" style="display:none">
    <div class="section-hdr">
      <div class="section-title">
        <svg class="section-title-icon" viewBox="0 0 24 24" fill="none"><path d="M4 5h16v14H4V5z" stroke="currentColor" stroke-width="1.5"/><path d="M8 3v4M16 3v4" stroke="currentColor" stroke-width="1.5"/><path d="M4 10h16" stroke="currentColor" stroke-width="1.5"/></svg>
        Következő Forduló
        <span class="season-badge" id="seasonBadgeMatches"></span>
      </div>
      <button class="btn" id="refreshMatchesBtn">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="none"><path d="M1 4v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Frissítés
      </button>
    </div>
    <div class="leaderboard-block">
      <div class="matches-header-bar">
        <span>Ford.</span><span>Idő</span><span>Hazai</span><span></span><span>Vendég</span>
      </div>
      <div class="lb-meta loading" id="matchesMeta">
        <span><span class="refresh-dot"></span>Betöltés...</span>
        <span id="matchesUpdateTime">–</span>
      </div>
      <div class="leaderboard-body" id="matchesTable">
        <div style="padding:24px;text-align:center;color:var(--text-muted);font-size:.7rem;font-family:'JetBrains Mono',monospace">Betöltés...</div>
      </div>
    </div>
  </div>

  <div class="error-box" id="errorBox">
    <svg style="width:14px;height:14px;flex-shrink:0" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/><path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
    <span id="errorText"></span>
  </div>
</div>

<script>
/* ═══ PARTICLES ═══ */
const canvas=document.getElementById('particleCanvas');const ctx=canvas.getContext('2d');let W,H,particles=[];
function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;}
resize();window.addEventListener('resize',resize);
class Particle{constructor(){this.reset();}reset(){this.x=Math.random()*W;this.y=Math.random()*H;this.vx=(Math.random()-.5)*.3;this.vy=-Math.random()*.5-.1;this.size=Math.random()*1.5+.3;this.life=0;this.maxLife=Math.random()*200+100;this.green=Math.random()>.7;}update(){this.x+=this.vx;this.y+=this.vy;this.life++;if(this.life>this.maxLife||this.y<-10)this.reset();}draw(){const a=Math.sin((this.life/this.maxLife)*Math.PI)*.5;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fillStyle=this.green?`rgba(0,230,118,${a*.7})`:`rgba(180,220,255,${a*.25})`;ctx.fill();}}
for(let i=0;i<100;i++){const p=new Particle();p.life=Math.random()*p.maxLife;particles.push(p);}
function animParticles(){ctx.clearRect(0,0,W,H);for(let i=0;i<particles.length;i++)for(let j=i+1;j<particles.length;j++){const dx=particles[i].x-particles[j].x,dy=particles[i].y-particles[j].y,d=Math.sqrt(dx*dx+dy*dy);if(d<80){ctx.beginPath();ctx.moveTo(particles[i].x,particles[i].y);ctx.lineTo(particles[j].x,particles[j].y);ctx.strokeStyle=`rgba(0,180,100,${(1-d/80)*.035})`;ctx.lineWidth=.5;ctx.stroke();}}particles.forEach(p=>{p.update();p.draw();});requestAnimationFrame(animParticles);}
animParticles();

/* ═══ CONFIG ═══ */
const LLM7_URL='https://api.llm7.io/v1/chat/completions';
const LLM7_KEY='/WF1cs8NieiVJAvBfBR+n5Fb/vxRW1oSmv3EqtTSTRxWQBGMexqcI4Xivs+BqTXfNYMZI8OUFZpv5YAA0FOjcumYWgcG8AkhePVVO8zCVKQo3GMYfArXw2yPPKY7w3tRvofNvQ==';
let realStandings=[],lastSeasonId=null,lastTotalPoints=null,currentTab='real';
let currentSeasonId = '3061057'; // Alapértelmezett, frissül a backendből

// Mintaadatok a legutóbbi meccsekhez (ha a backend nem adná vissza)
const MOCK_LAST_MATCHES = [
  { home: "Vörös Ördögök", away: "Nottingham", homeScore: 3, awayScore: 0 },
  { home: "Everton", away: "Brighton", homeScore: 2, awayScore: 0 },
  { home: "Fulham", away: "London Ágyúk", homeScore: 2, awayScore: 2 },
  { home: "Newcastle", away: "Liverpool", homeScore: 0, awayScore: 1 },
  { home: "West Ham", away: "Brentford", homeScore: 1, awayScore: 2 }
];

/* ═══ API HÍVÁSOK ═══ */
async function fetchRealStandings() {
  const res = await fetch('/api/standings?liga=pl');
  if (!res.ok) throw new Error(`API hiba: ${res.status}`);
  const data = await res.json();
  
  // Ha a backend visszaadta a szezon ID-t, tároljuk el
  if (data.seasonId) {
    currentSeasonId = data.seasonId;
    updateSeasonBadges(currentSeasonId);
  }
  
  return { standings: data.standings || [], seasonId: data.seasonId || null };
}

async function fetchNextMatches() {
  try {
    const res = await fetch('/api/standings?type=matches&liga=pl');
    if (!res.ok) throw new Error(`API hiba: ${res.status}`);
    const data = await res.json();
    
    // Ha a backend visszaadta a szezon ID-t, tároljuk el
    if (data.seasonId) {
      currentSeasonId = data.seasonId;
      updateSeasonBadges(currentSeasonId);
    }
    
    return data.matches || [];
  } catch (e) {
    console.warn('Nem sikerült betölteni a meccseket, mintaadatok használata:', e);
    // Fallback mintaadatok
    return [
      { round: 18, time: "12:16", homeTeam: "Brighton", awayTeam: "Chelsea", homeLogo: null, awayLogo: null },
      { round: 18, time: "12:16", homeTeam: "Crystal Palace", awayTeam: "Liverpool", homeLogo: null, awayLogo: null },
      { round: 18, time: "12:16", homeTeam: "Aston Oroszlán", awayTeam: "Newcastle", homeLogo: null, awayLogo: null },
      { round: 18, time: "12:16", homeTeam: "Wolverhampton", awayTeam: "Fulham", homeLogo: null, awayLogo: null },
      { round: 18, time: "12:16", homeTeam: "Nottingham", awayTeam: "Manchester Kék", homeLogo: null, awayLogo: null }
    ];
  }
}

/* ═══ MEGJELENÍTÉS ═══ */
function updateSeasonBadges(seasonId) {
  document.getElementById('seasonBadgeReal').textContent = `ID: ${seasonId}`;
  document.getElementById('seasonBadgeMatches').textContent = `ID: ${seasonId}`;
}

function renderRealTable(standings) {
  const table = document.getElementById('realTable'), meta = document.getElementById('realMeta');
  if (!standings || standings.length === 0) {
    table.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text-muted);font-size:.7rem">Nincs adat</div>';
    return;
  }
  const total = standings.length;
  table.innerHTML = standings.map((r, i) => 
    `<div class="${rowClass(r.pos, total)}" style="animation-delay:${i * .025}s">
      <span class="col-pos">${r.pos}</span>
      <span class="col-trend">${trendHtml(r.trend || 'same')}</span>
      <span class="col-team">${logoHtml(r.logo)}<span class="team-name">${r.team}</span></span>
      <span class="col-goals">${r.goalsFor || 0}:${r.goalsAgainst || 0}</span>
      <span class="col-gd">${gd(r.goalsFor, r.goalsAgainst)}</span>
      <span class="col-pts">${r.pts}</span>
    </div>`
  ).join('');
  meta.className = 'lb-meta';
  meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>Élő adat';
  document.getElementById('realUpdateTime').textContent = nowStr();
}

function renderMatchesTable(matches) {
  const table = document.getElementById('matchesTable'), meta = document.getElementById('matchesMeta');
  if (!matches || matches.length === 0) {
    table.innerHTML = '<div style="padding:32px;text-align:center;color:var(--text-muted);font-size:.7rem">Nincsenek következő mérkőzések</div>';
    return;
  }
  
  table.innerHTML = matches.map((m, i) => 
    `<div class="match-row" style="animation-delay:${i * .025}s">
      <span class="match-round">${m.round || '?'}. f</span>
      <span class="match-time">${m.time || '??:??'}</span>
      <span class="match-team">${logoHtml(m.homeLogo)} ${m.homeTeam}</span>
      <span class="match-vs">vs</span>
      <span class="match-team">${logoHtml(m.awayLogo)} ${m.awayTeam}</span>
    </div>`
  ).join('');
  
  meta.className = 'lb-meta';
  meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>Következő meccsek';
  document.getElementById('matchesUpdateTime').textContent = nowStr();
}

/* ═══ ADATOK BETÖLTÉSE ═══ */
async function loadRealTable() {
  const meta = document.getElementById('realMeta');
  meta.className = 'lb-meta loading';
  meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>Betöltés...';
  try {
    const { standings, seasonId } = await fetchRealStandings();
    detectSeasonReset(standings, seasonId);
    realStandings = standings;
    renderRealTable(standings);
  } catch (e) {
    showError(e.message);
    meta.className = 'lb-meta error';
    meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>Hiba';
  }
}

async function loadNextMatches() {
  const meta = document.getElementById('matchesMeta');
  meta.className = 'lb-meta loading';
  meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>Betöltés...';
  try {
    const matches = await fetchNextMatches();
    renderMatchesTable(matches);
  } catch (e) {
    showError(e.message);
    meta.className = 'lb-meta error';
    meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>Hiba';
  }
}

/* ═══ AI TÁBLA ÉS TIPPEK ═══ */
async function generateAITable() {
  const meta = document.getElementById('aiMeta'), aiTable = document.getElementById('aiTable'), aiPanel = document.getElementById('aiPanel'), aiBody = document.getElementById('aiBody');
  meta.className = 'lb-meta loading';
  meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>AI generálás...';
  aiTable.innerHTML = '<div class="dots"><span></span><span></span><span></span></div>';
  aiPanel.style.display = 'none';
  hideError();
  
  // Ha nincs tabella adat, töltsük be
  if (realStandings.length === 0) {
    try {
      const { standings } = await fetchRealStandings();
      realStandings = standings;
    } catch (e) {
      showError('Valódi adatok betöltése sikertelen: ' + e.message);
      meta.className = 'lb-meta error';
      return;
    }
  }
  
  // Tabella formázása
  const allTeamsData = realStandings.map(t => 
    `${t.pos}. ${t.team}: ${t.pts}pt, ${t.goalsFor || 0}:${t.goalsAgainst || 0}`
  ).join('\n');
  
  // Utolsó meccsek a tippekhez
  const lastMatchesText = MOCK_LAST_MATCHES.map(m => 
    `${m.home} ${m.homeScore}:${m.awayScore} ${m.away}`
  ).join('\n');
  
  // Először generáljuk az AI tabellát
  const tablePrompt = `Te egy virtuális futball liga profi elemzője vagy. A jelenlegi tabella alapján készíts SAJÁT, FÜGGETLEN előrejelzést a szezon végére!

JELENLEGI TABELLA (szezon ID: ${currentSeasonId}):
${allTeamsData}

LEGUTÓBBI MÉRKŐZÉSEK (figyelembe veendő):
${lastMatchesText}

SZABÁLYOK:
1. Sorrend VÁLTOZZON – legalább 5 csapat kerüljön más helyre!
2. Pontok és gólok KÜLÖNBÖZZENEK a valóstól!
3. Egy középcsapat kerüljön fel, egy top csapat essen vissza!
4. TILOS a valós adatok másolása!

Válaszolj KIZÁRÓLAG kompakt JSON tömbbel:
[{"pos":1,"team":"Név","goalsFor":72,"goalsAgainst":28,"pts":87,"trend":"up"},...]`;

  try {
    meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>AI tabella generálás...';
    const tableText = await callAI(tablePrompt, 0.9);
    
    // JSON kinyerése
    const clean = tableText.replace(/```json\s*/gi, '').replace(/```\s*/g, '').trim();
    const start = clean.indexOf('[');
    if (start === -1) throw new Error('JSON nem található');
    
    const aiStandings = JSON.parse(clean.slice(start)).map(r => ({
      pos: r.pos,
      team: r.team,
      goalsFor: r.goalsFor || 0,
      goalsAgainst: r.goalsAgainst || 0,
      pts: r.pts || 0,
      trend: r.trend || 'same'
    }));
    
    if (!aiStandings || aiStandings.length === 0) throw new Error('Üres tabella');
    
    // AI tabella megjelenítése
    const total = aiStandings.length;
    aiTable.innerHTML = aiStandings.map((r, i) => 
      `<div class="${rowClass(r.pos, total)}" style="animation-delay:${i * .025}s">
        <span class="col-pos">${r.pos}</span>
        <span class="col-trend">${trendHtml(r.trend)}</span>
        <span class="col-team"><span class="team-logo-placeholder"></span><span class="team-name">${r.team}</span></span>
        <span class="col-goals">${r.goalsFor}:${r.goalsAgainst}</span>
        <span class="col-gd">${gd(r.goalsFor, r.goalsAgainst)}</span>
        <span class="col-pts">${r.pts}</span>
      </div>`
    ).join('');
    
    meta.className = 'lb-meta';
    meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>AI becslés';
    document.getElementById('aiUpdateTime').textContent = nowStr();
    
    // Most generáljuk a tippeket is
    const top3 = aiStandings.slice(0, 3).map(t => `${t.pos}. ${t.team} (${t.pts}pt)`).join(', ');
    const bot3 = aiStandings.slice(-3).map(t => `${t.pos}. ${t.team} (${t.pts}pt)`).join(', ');
    
    const tipsPrompt = `A következő AI előrejelzés alapján adj 3 darab TIPPET a következő fordulókra:

ELŐREJELZÉS TOP3: ${top3}
ELŐREJELZÉS UTOLSÓ 3: ${bot3}

LEGUTÓBBI MÉRKŐZÉSEK:
${lastMatchesText}

Adj 3 tippet magyar nyelven, minden tipp tartalmazza:
- Mérkőzés (csapatok)
- Tipp típusa
- Rövid indoklás`;

    meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>AI tippek generálás...';
    const tipsText = await callAI(tipsPrompt, 0.8);
    
    if (tipsText) {
      aiBody.innerHTML = tipsText.replace(/\n/g, '<br>');
      aiPanel.style.display = 'block';
    }
    
  } catch (e) {
    showError('AI hiba: ' + e.message);
    meta.className = 'lb-meta error';
    meta.querySelector('span:first-child').innerHTML = '<span class="refresh-dot"></span>Hiba';
    aiTable.innerHTML = '<div style="padding:32px;text-align:center;color:var(--text-muted);font-size:.7rem;font-family:\'JetBrains Mono\',monospace">Hiba a generálás során</div>';
  }
}

/* ═══ SEGÉDFÜGGVÉNYEK ═══ */
function gd(gf, ga) {
  const d = (gf || 0) - (ga || 0);
  if (d > 0) return `<span style="color:var(--green);text-shadow:0 0 6px rgba(0,230,118,0.4)">+${d}</span>`;
  if (d < 0) return `<span style="color:var(--red)">${d}</span>`;
  return `<span style="color:#1a2e3d">0</span>`;
}

function trendHtml(t) {
  if (t === 'up') return '<span class="trend-up">▲</span>';
  if (t === 'down') return '<span class="trend-down">▼</span>';
  return '<span class="trend-same">—</span>';
}

function logoHtml(logo) {
  if (!logo) return '<span class="team-logo-placeholder"></span>';
  return `<img class="team-logo" src="${logo}" alt="" loading="lazy" onerror="this.style.display=\'none\'">`;
}

function rowClass(pos, total) {
  if (pos <= 3) return 'lb-row top3';
  if (total && pos > total - 3) return 'lb-row relegation';
  return 'lb-row';
}

function nowStr() {
  return new Date().toLocaleTimeString('hu-HU', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
}

function showError(msg) {
  document.getElementById('errorText').textContent = msg;
  document.getElementById('errorBox').classList.add('show');
}

function hideError() {
  document.getElementById('errorBox').classList.remove('show');
}

function detectSeasonReset(standings, serverSeasonId) {
  const totalPoints = standings.reduce((s, t) => s + (t.pts || 0), 0);
  let isReset = false;
  
  if (serverSeasonId && lastSeasonId && serverSeasonId !== lastSeasonId) {
    isReset = true;
    currentSeasonId = serverSeasonId;
    updateSeasonBadges(serverSeasonId);
  }
  
  if (lastTotalPoints !== null && lastTotalPoints > 100 && totalPoints < lastTotalPoints * 0.3) {
    isReset = true;
  }
  
  if (isReset) {
    document.getElementById('seasonNoticeText').textContent = serverSeasonId ? `Új szezon (ID: ${serverSeasonId})` : 'Szezonváltás';
    document.getElementById('seasonNotice').style.display = 'flex';
  }
  
  lastTotalPoints = totalPoints;
  if (serverSeasonId) lastSeasonId = serverSeasonId;
}

function showTab(tab) {
  currentTab = tab;
  document.getElementById('realContainer').style.display = tab === 'real' ? 'block' : 'none';
  document.getElementById('aiContainer').style.display = tab === 'ai' ? 'block' : 'none';
  document.getElementById('matchesContainer').style.display = tab === 'matches' ? 'block' : 'none';
  
  document.getElementById('realTab').classList.toggle('active', tab === 'real');
  document.getElementById('aiTab').classList.toggle('active', tab === 'ai');
  document.getElementById('matchesTab').classList.toggle('active', tab === 'matches');
}

async function callAI(prompt, temp = 0.7) {
  const res = await fetch(LLM7_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${LLM7_KEY}` },
    body: JSON.stringify({ model: 'default', messages: [{ role: 'user', content: prompt }], temperature: temp, max_tokens: 2048 })
  });
  if (!res.ok) throw new Error(`LLM7 hiba: ${res.status}`);
  const d = await res.json();
  return d.choices?.[0]?.message?.content || '';
}

/* ═══ ESEMÉNYKEZELŐK ═══ */
document.addEventListener('DOMContentLoaded', () => {
  loadRealTable();
  loadNextMatches(); // Előre betöltjük a meccseket is
  
  document.getElementById('refreshRealBtn').addEventListener('click', loadRealTable);
  document.getElementById('refreshMatchesBtn').addEventListener('click', loadNextMatches);
  document.getElementById('generateAIBtn').addEventListener('click', generateAITable);
  
  setInterval(loadRealTable, 30000); // 30 másodperces frissítés
  setInterval(loadNextMatches, 60000); // 1 perces frissítés a meccseknek
});
</script>
</body>
</html>
