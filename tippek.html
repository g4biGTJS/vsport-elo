<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VSPORT – AI Tabella</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#030507;--surface:#070c10;--surface2:#0b1218;--surface3:#0f1820;
      --border:#0e1e28;--border2:#162535;
      --text:#d4e8f0;--text-dim:#4a7a99;--text-muted:#1e3d52;
      --green:#00e676;--green2:#00c853;--red:#ff3d3d;--amber:#ffab00;--cyan:#00b8d4;
      --purple:#b388ff;
    }
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    html,body{background:var(--bg);color:var(--text);font-family:'Barlow',sans-serif;min-height:100vh;overflow-x:hidden;}

    /* ── BACKGROUND ── */
    .bg-layer{position:fixed;inset:0;z-index:0;pointer-events:none;}
    .bg-mesh{background:radial-gradient(ellipse 80% 60% at 20% 30%,rgba(0,80,40,0.18) 0%,transparent 60%),radial-gradient(ellipse 60% 80% at 80% 70%,rgba(0,40,80,0.2) 0%,transparent 60%),radial-gradient(ellipse 100% 40% at 50% 100%,rgba(0,100,60,0.12) 0%,transparent 50%),#030507;animation:meshShift 12s ease-in-out infinite alternate;}
    @keyframes meshShift{0%{background-position:0% 0%,100% 100%,50% 100%}50%{background-position:10% 20%,80% 80%,60% 90%}100%{background-position:20% 5%,70% 90%,50% 80%}}
    .bg-orbs{overflow:hidden;}
    .orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:1;animation:orbFloat linear infinite;}
    .orb1{width:500px;height:500px;background:radial-gradient(circle,rgba(0,180,80,0.12) 0%,transparent 70%);top:-100px;left:-100px;animation-duration:25s;}
    .orb2{width:400px;height:400px;background:radial-gradient(circle,rgba(0,100,200,0.1) 0%,transparent 70%);top:30%;right:-80px;animation-duration:30s;animation-delay:-8s;}
    .orb3{width:350px;height:350px;background:radial-gradient(circle,rgba(0,220,100,0.08) 0%,transparent 70%);bottom:10%;left:30%;animation-duration:20s;animation-delay:-15s;}
    @keyframes orbFloat{0%{transform:translate(0,0) scale(1)}25%{transform:translate(40px,-30px) scale(1.1)}50%{transform:translate(-20px,50px) scale(0.95)}75%{transform:translate(30px,20px) scale(1.05)}100%{transform:translate(0,0) scale(1)}}
    .bg-grid{background-image:linear-gradient(rgba(0,180,100,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,180,100,0.025) 1px,transparent 1px);background-size:60px 60px;animation:gridSlide 20s linear infinite;}
    @keyframes gridSlide{0%{background-position:0 0}100%{background-position:60px 60px}}
    .bg-scan{background:linear-gradient(to bottom,transparent 49.9%,rgba(0,230,118,0.03) 50%,transparent 50.1%);background-size:100% 8px;animation:scanMove 3s linear infinite;}
    @keyframes scanMove{0%{background-position:0 0}100%{background-position:0 8px}}
    .bg-noise{opacity:.035;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");background-size:256px;animation:grainAnim .4s steps(1) infinite;}
    @keyframes grainAnim{0%{transform:translate(0,0)}10%{transform:translate(-3%,-2%)}20%{transform:translate(3%,2%)}30%{transform:translate(-2%,3%)}40%{transform:translate(2%,-3%)}50%{transform:translate(-3%,2%)}60%{transform:translate(3%,-2%)}70%{transform:translate(-2%,-3%)}80%{transform:translate(2%,3%)}90%{transform:translate(-3%,3%)}100%{transform:translate(3%,-1%)}}
    .bg-vignette{background:radial-gradient(ellipse 100% 100% at 50% 50%,transparent 40%,rgba(0,0,0,0.7) 100%);}
    #particleCanvas{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.5;}

    /* ── HEADER ── */
    header{position:sticky;top:0;z-index:100;background:rgba(3,5,7,0.92);backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid rgba(0,230,118,0.1);padding:0 28px;height:58px;display:flex;align-items:center;gap:16px;box-shadow:0 4px 32px rgba(0,0,0,0.6);}
    header::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(0,230,118,0.4) 30%,rgba(0,230,118,0.8) 50%,rgba(0,230,118,0.4) 70%,transparent 100%);background-size:200% 100%;animation:lineSlide 4s linear infinite;}
    @keyframes lineSlide{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .header-left{display:flex;align-items:center;gap:14px;animation:slideL .7s cubic-bezier(.16,1,.3,1) both;}
    .header-right{margin-left:auto;display:flex;align-items:center;gap:10px;animation:slideR .7s cubic-bezier(.16,1,.3,1) .1s both;}
    @keyframes slideL{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
    @keyframes slideR{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}
    .live-pulse-wrap{position:relative;display:flex;align-items:center;justify-content:center;width:28px;height:28px;}
    .live-pulse-ring{position:absolute;width:28px;height:28px;border-radius:50%;border:1px solid rgba(0,230,118,0.4);animation:ringPulse 2s ease-out infinite;}
    .live-pulse-ring:nth-child(2){animation-delay:.5s;}
    @keyframes ringPulse{0%{transform:scale(.5);opacity:1}100%{transform:scale(1.4);opacity:0}}
    .live-dot-core{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 12px var(--green),0 0 24px rgba(0,230,118,0.4);position:relative;z-index:1;animation:corePulse 2s ease-in-out infinite;}
    @keyframes corePulse{0%,100%{box-shadow:0 0 8px var(--green),0 0 16px rgba(0,230,118,0.3)}50%{box-shadow:0 0 16px var(--green),0 0 32px rgba(0,230,118,0.6)}}
    .site-title{font-family:'Barlow Condensed',sans-serif;font-size:1.8rem;font-weight:900;letter-spacing:6px;color:#fff;text-transform:uppercase;text-shadow:0 0 30px rgba(255,255,255,0.2);position:relative;}
    .site-title::before,.site-title::after{content:'VSPORT';position:absolute;left:0;top:0;opacity:0;}
    .site-title::before{color:var(--green);animation:g1 8s infinite;clip-path:polygon(0 30%,100% 30%,100% 50%,0 50%);}
    .site-title::after{color:var(--cyan);animation:g2 8s infinite;clip-path:polygon(0 60%,100% 60%,100% 80%,0 80%);}
    @keyframes g1{0%,92%,100%{opacity:0;transform:none}93%{opacity:.7;transform:translate(-2px,0)}94%{opacity:0}96%{opacity:.5;transform:translate(2px,0)}97%{opacity:0}}
    @keyframes g2{0%,93%,100%{opacity:0;transform:none}94%{opacity:.5;transform:translate(2px,1px)}95%{opacity:0}97%{opacity:.4;transform:translate(-2px,0)}98%{opacity:0}}
    .header-sep{width:1px;height:24px;background:linear-gradient(to bottom,transparent,var(--border2),transparent);}
    .back-btn{display:flex;align-items:center;gap:8px;color:var(--text-dim);font-family:'JetBrains Mono',monospace;font-size:.58rem;text-decoration:none;letter-spacing:1.5px;padding:6px 14px;border:1px solid rgba(0,230,118,0.15);border-radius:2px;transition:all .25s;background:rgba(0,230,118,0.04);}
    .back-btn:hover{color:var(--green);border-color:rgba(0,230,118,0.4);box-shadow:0 0 16px rgba(0,230,118,0.1);}
    .ai-header-badge{display:flex;align-items:center;gap:8px;background:rgba(0,230,118,0.08);border:1px solid rgba(0,230,118,0.2);border-radius:2px;padding:5px 14px;font-family:'JetBrains Mono',monospace;font-size:.58rem;letter-spacing:2px;color:var(--green);box-shadow:0 0 16px rgba(0,230,118,0.08);}
    .ai-badge-dot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:corePulse 1.5s infinite;}

    /* ── PAGE ── */
    .page{position:relative;z-index:1;max-width:980px;margin:0 auto;padding:28px 20px 80px;animation:pageUp .6s cubic-bezier(.16,1,.3,1) .1s both;}
    @keyframes pageUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    /* ── TABS ── */
    .tabs{display:flex;margin-bottom:24px;border-bottom:1px solid rgba(0,230,118,0.08);gap:2px;}
    .tab{background:none;border:none;border-bottom:2px solid transparent;color:var(--text-dim);font-family:'JetBrains Mono',monospace;font-size:.58rem;letter-spacing:2px;padding:10px 20px;cursor:pointer;transition:all .2s;text-transform:uppercase;display:flex;align-items:center;gap:8px;position:relative;top:1px;}
    .tab:hover{color:rgba(0,230,118,0.7);}
    .tab.active{color:var(--green);border-bottom-color:var(--green);text-shadow:0 0 12px rgba(0,230,118,0.4);}
    .tab-icon{width:13px;height:13px;}

    /* ── SECTION HEADER ── */
    .section-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px;}
    .section-title{font-family:'Barlow Condensed',sans-serif;font-size:1.35rem;font-weight:800;letter-spacing:4px;color:var(--text);display:flex;align-items:center;gap:12px;text-transform:uppercase;}
    .ai-badge-pill{background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.25);color:var(--green);font-size:.5rem;font-family:'JetBrains Mono',monospace;padding:3px 10px;border-radius:2px;letter-spacing:1.5px;}

    /* ── BUTTONS ── */
    .btn{display:flex;align-items:center;gap:8px;background:linear-gradient(135deg,var(--surface2),var(--surface3));border:1px solid var(--border2);color:var(--text-dim);font-size:.58rem;font-family:'JetBrains Mono',monospace;letter-spacing:1.5px;padding:8px 16px;border-radius:2px;cursor:pointer;transition:all .2s;text-transform:uppercase;}
    .btn:hover{background:rgba(0,230,118,0.06);border-color:rgba(0,230,118,0.3);color:var(--green);box-shadow:0 0 20px rgba(0,230,118,0.1);}
    .btn:disabled{opacity:.4;cursor:not-allowed;pointer-events:none;}
    .btn-primary{background:linear-gradient(135deg,rgba(0,230,118,0.12),rgba(0,180,80,0.08));border-color:rgba(0,230,118,0.3);color:var(--green);}
    .btn-primary:hover{background:rgba(0,230,118,0.18);box-shadow:0 0 24px rgba(0,230,118,0.15);}
    .btn-icon{width:13px;height:13px;}

    /* ── SEASON NOTICE ── */
    .season-notice{display:none;align-items:center;gap:10px;background:rgba(255,171,0,0.06);border:1px solid rgba(255,171,0,0.2);border-radius:2px;padding:10px 14px;margin-bottom:16px;font-size:.68rem;color:var(--amber);font-family:'JetBrains Mono',monospace;}

    /* ── STAT CARDS ── */
    .stat-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:18px;}
    @media(max-width:600px){.stat-cards{grid-template-columns:1fr;}}
    .stat-card{background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:14px 16px;position:relative;overflow:hidden;transition:border-color .2s;}
    .stat-card:hover{border-color:var(--border2);}
    .stat-card::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;}
    .stat-card.green::before{background:linear-gradient(to bottom,var(--green),transparent);}
    .stat-card.red::before{background:linear-gradient(to bottom,var(--red),transparent);}
    .stat-card.amber::before{background:linear-gradient(to bottom,var(--amber),transparent);}
    .stat-card.purple::before{background:linear-gradient(to bottom,var(--purple),transparent);}
    .stat-card-label{font-family:'JetBrains Mono',monospace;font-size:.48rem;letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;opacity:.6;}
    .stat-card.green .stat-card-label{color:var(--green);}
    .stat-card.red .stat-card-label{color:var(--red);}
    .stat-card.amber .stat-card-label{color:var(--amber);}
    .stat-card.purple .stat-card-label{color:var(--purple);}
    .stat-card-value{font-family:'Barlow Condensed',sans-serif;font-size:1rem;font-weight:700;color:var(--text);letter-spacing:1px;}
    .stat-card-sub{font-size:.65rem;color:var(--text-dim);margin-top:4px;}

    /* ── LEADERBOARD ── */
    .leaderboard-block{background:var(--surface);border:1px solid var(--border);border-radius:3px;overflow:hidden;margin-bottom:16px;position:relative;}
    .leaderboard-block::before{content:'';position:absolute;top:0;left:0;width:36px;height:36px;border-top:2px solid rgba(0,230,118,0.2);border-left:2px solid rgba(0,230,118,0.2);pointer-events:none;z-index:2;}
    .leaderboard-header-bar{background:linear-gradient(90deg,rgba(0,50,25,0.9) 0%,rgba(0,80,40,0.6) 50%,rgba(0,50,25,0.3) 100%);display:grid;grid-template-columns:28px 18px 1fr 54px 80px 46px 52px;align-items:center;padding:8px 12px;gap:4px;border-bottom:1px solid rgba(0,230,118,0.12);}
    .leaderboard-header-bar span{font-family:'JetBrains Mono',monospace;font-size:.5rem;font-weight:700;color:rgba(0,230,118,0.65);text-transform:uppercase;letter-spacing:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .leaderboard-header-bar .h-right{text-align:right;}
    .lb-meta{background:rgba(0,0,0,0.4);border-bottom:1px solid var(--border);padding:4px 12px;font-size:.54rem;color:var(--text-muted);display:flex;justify-content:space-between;align-items:center;font-family:'JetBrains Mono',monospace;}
    .refresh-dot{width:5px;height:5px;border-radius:50%;background:var(--green);display:inline-block;margin-right:5px;animation:corePulse 2s infinite;}
    .lb-meta.loading .refresh-dot{background:var(--amber);box-shadow:0 0 6px rgba(255,171,0,0.4);}
    .lb-meta.error .refresh-dot{background:var(--red);}
    .leaderboard-body{background:var(--surface);}
    .lb-row{display:grid;grid-template-columns:28px 18px 1fr 54px 80px 46px 52px;align-items:center;padding:5px 12px;gap:4px;border-bottom:1px solid var(--border);transition:background .15s,transform .15s;animation:rowSlide .4s ease both;position:relative;}
    .lb-row:last-child{border-bottom:none;}
    .lb-row::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;opacity:0;transition:opacity .15s;}
    .lb-row:hover::before{opacity:1;}
    .lb-row:hover{background:var(--surface2);transform:translateX(2px);}
    @keyframes rowSlide{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:translateX(0)}}
    .lb-row.top3{background:linear-gradient(90deg,rgba(0,100,45,0.15) 0%,transparent 100%);}
    .lb-row.top3::before{background:var(--green);}
    .lb-row.top3:hover{background:rgba(0,100,45,0.2);}
    .lb-row.relegation{background:linear-gradient(90deg,rgba(255,61,61,0.07) 0%,transparent 100%);}
    .lb-row.relegation::before{background:var(--red);}
    .col-pos{font-family:'JetBrains Mono',monospace;font-size:.68rem;font-weight:700;color:var(--text-dim);text-align:center;}
    .lb-row.top3 .col-pos{color:var(--green);text-shadow:0 0 8px rgba(0,230,118,0.4);}
    .lb-row.relegation .col-pos{color:var(--red);}
    .col-trend{display:flex;align-items:center;justify-content:center;}
    .trend-up{color:var(--green);font-size:.5rem;filter:drop-shadow(0 0 4px rgba(0,230,118,0.6));}
    .trend-down{color:var(--red);font-size:.5rem;filter:drop-shadow(0 0 4px rgba(255,61,61,0.6));}
    .trend-same{color:#1a2e3d;font-size:.5rem;}
    .col-conf{display:flex;align-items:center;justify-content:center;}
    .conf-bar{width:36px;height:4px;border-radius:2px;background:var(--border2);overflow:hidden;}
    .conf-fill{height:100%;border-radius:2px;transition:width .6s ease;}
    .col-team{display:flex;align-items:center;gap:7px;min-width:0;}
    .team-logo{width:16px;height:16px;object-fit:contain;flex-shrink:0;}
    .team-logo-placeholder{width:16px;height:16px;flex-shrink:0;}
    .team-name{font-size:.73rem;font-weight:600;color:#aac5d4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .lb-row.top3 .team-name{color:var(--text);}
    .col-goals{font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--text-dim);text-align:right;}
    .col-gd{font-family:'JetBrains Mono',monospace;font-size:.58rem;color:var(--text-muted);text-align:right;}
    .col-pts-wrap{display:flex;flex-direction:column;align-items:flex-end;gap:2px;}
    .col-pts{font-family:'JetBrains Mono',monospace;font-size:.78rem;font-weight:700;color:#fff;text-align:right;text-shadow:0 0 12px rgba(255,255,255,0.15);}
    .lb-row.top3 .col-pts{color:var(--green);text-shadow:0 0 12px rgba(0,230,118,0.4);}
    .pts-bar{width:100%;height:2px;background:var(--border2);border-radius:1px;overflow:hidden;}
    .pts-bar-fill{height:100%;border-radius:1px;background:var(--green);opacity:.45;transition:width .8s ease;}
    .lb-row.relegation .pts-bar-fill{background:var(--red);}

    /* ── AI PANEL ── */
    .aipanel{background:var(--surface);border:1px solid rgba(0,230,118,0.1);border-radius:3px;overflow:hidden;margin-top:16px;animation:rowSlide .5s ease both;position:relative;}
    .aipanel::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(0,230,118,0.5),transparent);}
    .aipanel-hdr{background:linear-gradient(90deg,rgba(0,50,25,0.7),rgba(0,20,10,0.5));border-bottom:1px solid rgba(0,230,118,0.08);padding:10px 16px;display:flex;align-items:center;gap:10px;}
    .aipanel-title{font-family:'Barlow Condensed',sans-serif;font-size:.9rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--text);}
    .aibody{padding:18px 20px;font-size:.84rem;line-height:1.95;color:var(--text-dim);min-height:80px;}

    /* ── PROGRESS STEPPER ── */
    .ai-progress{background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-bottom:16px;display:none;}
    .ai-progress.show{display:block;animation:rowSlide .3s ease both;}
    .progress-steps{display:flex;flex-direction:column;gap:8px;}
    .step{display:flex;align-items:center;gap:12px;font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--text-muted);transition:color .3s;}
    .step.active{color:var(--amber);}
    .step.done{color:var(--green);}
    .step-icon{width:18px;height:18px;border-radius:50%;border:1px solid currentColor;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:.5rem;}
    .step.active .step-icon{animation:corePulse 1s infinite;}
    .step.done .step-icon{background:rgba(0,230,118,0.15);}

    /* ── COMPARE VIEW ── */
    .compare-row{display:grid;grid-template-columns:1fr auto 1fr;gap:0;border-bottom:1px solid var(--border);align-items:center;}
    .compare-row:last-child{border-bottom:none;}
    .compare-team{padding:6px 12px;display:flex;align-items:center;gap:8px;transition:background .15s;}
    .compare-team:hover{background:var(--surface2);}
    .compare-team.real-side{justify-content:flex-start;}
    .compare-team.ai-side{justify-content:flex-end;flex-direction:row-reverse;}
    .compare-pos{font-family:'JetBrains Mono',monospace;font-size:.68rem;font-weight:700;width:20px;text-align:center;flex-shrink:0;}
    .compare-name{font-size:.72rem;font-weight:600;color:#aac5d4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:120px;}
    .compare-pts{font-family:'JetBrains Mono',monospace;font-size:.7rem;font-weight:700;color:var(--text-dim);flex-shrink:0;}
    .compare-mid{display:flex;align-items:center;justify-content:center;width:52px;flex-shrink:0;}
    .move-badge{font-family:'JetBrains Mono',monospace;font-size:.52rem;padding:2px 6px;border-radius:1px;font-weight:700;}
    .move-up{background:rgba(0,230,118,0.12);color:var(--green);}
    .move-down{background:rgba(255,61,61,0.1);color:var(--red);}
    .move-same{background:rgba(255,255,255,0.04);color:var(--text-muted);}
    .compare-header{display:grid;grid-template-columns:1fr auto 1fr;background:linear-gradient(90deg,rgba(0,50,25,0.6),rgba(0,20,10,0.8),rgba(0,20,80,0.4));border-bottom:1px solid rgba(0,230,118,0.12);}
    .compare-header-side{padding:8px 12px;font-family:'JetBrains Mono',monospace;font-size:.5rem;letter-spacing:2px;color:rgba(0,230,118,0.6);text-transform:uppercase;}
    .compare-header-side.ai-side{text-align:right;color:rgba(0,184,212,0.6);}
    .compare-header-mid{width:52px;display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono',monospace;font-size:.44rem;color:var(--text-muted);}

    /* ── DOTS LOADER ── */
    .dots{display:flex;gap:6px;padding:20px 0;justify-content:center;}
    .dots span{width:6px;height:6px;border-radius:50%;background:var(--green);opacity:.15;animation:dotPulse 1.2s infinite;}
    .dots span:nth-child(2){animation-delay:.2s;}.dots span:nth-child(3){animation-delay:.4s;}
    @keyframes dotPulse{0%,100%{opacity:.15}50%{opacity:.9;box-shadow:0 0 8px var(--green)}}

    /* ── ERROR ── */
    .error-box{display:none;background:rgba(255,61,61,0.06);border:1px solid rgba(255,61,61,0.2);border-radius:2px;padding:12px 16px;font-size:.72rem;color:#ff8a80;margin-bottom:16px;font-family:'JetBrains Mono',monospace;}
    .error-box.show{display:flex;align-items:center;gap:8px;}

    .footer-line{position:fixed;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent 0%,rgba(0,230,118,0.2) 20%,rgba(0,230,118,0.6) 50%,rgba(0,230,118,0.2) 80%,transparent 100%);z-index:50;}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .skeleton-row{height:34px;background:linear-gradient(90deg,var(--surface2) 25%,var(--surface3) 50%,var(--surface2) 75%);background-size:200% 100%;animation:shimmer 1.4s infinite;border-bottom:1px solid var(--border);border-radius:0;}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
  </style>
</head>
<body>
<div class="bg-layer bg-mesh"></div>
<div class="bg-layer bg-orbs"><div class="orb orb1"></div><div class="orb orb2"></div><div class="orb orb3"></div></div>
<div class="bg-layer bg-grid"></div>
<div class="bg-layer bg-scan"></div>
<div class="bg-layer bg-noise"></div>
<div class="bg-layer bg-vignette"></div>
<canvas id="particleCanvas"></canvas>
<div class="footer-line"></div>

<header>
  <div class="header-left">
    <div class="live-pulse-wrap">
      <div class="live-pulse-ring"></div><div class="live-pulse-ring"></div>
      <div class="live-dot-core"></div>
    </div>
    <div class="header-sep"></div>
    <span class="site-title">VSPORT</span>
    <div class="header-sep"></div>
    <a class="back-btn" href="/">
      <svg style="width:11px;height:11px" viewBox="0 0 24 24" fill="none"><path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Vissza
    </a>
  </div>
  <div class="header-right">
    <div class="ai-header-badge">
      <div class="ai-badge-dot"></div>
      AI Elemző
    </div>
  </div>
</header>

<div class="page">
  <div class="tabs">
    <button class="tab active" id="realTab" onclick="showTab('real')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none"><path d="M3 3v18h18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M7 16l4-4 4 4 4-7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Tabella
    </button>
    <button class="tab" id="aiTab" onclick="showTab('ai')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none"><path d="M12 2L13.5 8.5L20 10L13.5 11.5L12 18L10.5 11.5L4 10L10.5 8.5L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
      AI Előrejelzés
    </button>
    <button class="tab" id="compareTab" onclick="showTab('compare')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none"><path d="M18 20V10M12 20V4M6 20v-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Összehasonlítás
    </button>
  </div>

  <!-- ══ TABELLA ══ -->
  <div id="realContainer">
    <div class="section-hdr">
      <div class="section-title">
        <svg style="width:18px;height:18px;opacity:.9" viewBox="0 0 24 24" fill="none"><path d="M13 2L4.5 13.5H11L10 22L19.5 10.5H13L13 2Z" fill="currentColor" stroke="currentColor" stroke-width="0.5" stroke-linejoin="round"/></svg>
        Premier Liga
      </div>
      <button class="btn" id="refreshRealBtn">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="none"><path d="M1 4v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Frissítés
      </button>
    </div>
    <div id="realStatCards" class="stat-cards" style="display:none"></div>
    <div class="leaderboard-block">
      <div class="leaderboard-header-bar">
        <span>#</span><span></span><span>Csapat</span><span class="h-right">Pont</span>
        <span class="h-right">Lőtt–Kapott</span><span class="h-right">GD</span><span class="h-right">Pont/F</span>
      </div>
      <div class="lb-meta loading" id="realMeta">
        <span><span class="refresh-dot"></span>Betöltés...</span>
        <span id="realUpdateTime">–</span>
      </div>
      <div class="leaderboard-body" id="realTable">
        <div class="skeleton-row"></div><div class="skeleton-row"></div><div class="skeleton-row"></div>
        <div class="skeleton-row"></div><div class="skeleton-row"></div><div class="skeleton-row"></div>
      </div>
    </div>
  </div>

  <!-- ══ AI ELŐREJELZÉS ══ -->
  <div id="aiContainer" style="display:none">
    <div class="section-hdr">
      <div class="section-title">
        <svg style="width:18px;height:18px;opacity:.9" viewBox="0 0 24 24" fill="none"><path d="M12 2L13.5 8.5L20 10L13.5 11.5L12 18L10.5 11.5L4 10L10.5 8.5L12 2Z" fill="currentColor" stroke="currentColor" stroke-width="0.5"/></svg>
        AI Előrejelzés
        <span class="ai-badge-pill">LLM7</span>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="refreshAIBtn" style="display:none">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none"><path d="M1 4v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Újra
        </button>
        <button class="btn btn-primary" id="generateAIBtn">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none"><path d="M12 2L13.5 8.5L20 10L13.5 11.5L12 18L10.5 11.5L4 10L10.5 8.5L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
          Generálás
        </button>
      </div>
    </div>
    <div class="season-notice" id="seasonNotice">
      <svg style="width:14px;height:14px;flex-shrink:0" viewBox="0 0 24 24" fill="none"><path d="M12 9v4m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      <span id="seasonNoticeText">Új szezon érzékelve</span>
    </div>
    <!-- Progress stepper -->
    <div class="ai-progress" id="aiProgress">
      <div class="progress-steps">
        <div class="step" id="step1"><div class="step-icon">1</div><span>Valós adatok elemzése és statisztikák számítása...</span></div>
        <div class="step" id="step2"><div class="step-icon">2</div><span>AI előrejelzés generálása (szezon vége becslés)...</span></div>
        <div class="step" id="step3"><div class="step-icon">3</div><span>Szöveges elemzés készítése...</span></div>
        <div class="step" id="step4"><div class="step-icon">4</div><span>Vizualizáció renderelése...</span></div>
      </div>
    </div>
    <!-- AI insight cards -->
    <div id="aiStatCards" class="stat-cards" style="display:none"></div>
    <div class="leaderboard-block">
      <div class="leaderboard-header-bar">
        <span>#</span><span></span><span>Csapat</span><span></span>
        <span class="h-right">Lőtt–Kapott</span><span class="h-right">GD</span><span class="h-right">Pont</span>
      </div>
      <div class="lb-meta" id="aiMeta">
        <span><span class="refresh-dot"></span>AI becslés</span>
        <span id="aiUpdateTime">–</span>
      </div>
      <div class="leaderboard-body" id="aiTable">
        <div style="padding:36px;text-align:center;color:var(--text-muted);font-size:.7rem;font-family:'JetBrains Mono',monospace;line-height:2.4">
          Kattints a <strong style="color:var(--green)">"Generálás"</strong> gombra<br>
          <span style="color:#0e1e28;font-size:.56rem">Az AI elemzi a valós adatokat, majd előrejelzést készít a szezon végére</span>
        </div>
      </div>
    </div>
    <div class="aipanel" id="aiPanel" style="display:none">
      <div class="aipanel-hdr">
        <svg style="width:16px;height:16px" viewBox="0 0 24 24" fill="none"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z" stroke="var(--green)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span class="aipanel-title">AI Elemzés</span>
        <span class="ai-badge-pill" style="margin-left:auto">llm7.io</span>
      </div>
      <div class="aibody" id="aiBody"></div>
    </div>
  </div>

  <!-- ══ ÖSSZEHASONLÍTÁS ══ -->
  <div id="compareContainer" style="display:none">
    <div class="section-hdr">
      <div class="section-title">
        <svg style="width:18px;height:18px;opacity:.9" viewBox="0 0 24 24" fill="none"><path d="M18 20V10M12 20V4M6 20v-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Valós vs AI
      </div>
    </div>
    <div class="leaderboard-block" id="compareBlock">
      <div class="compare-header">
        <div class="compare-header-side">Valós tabella</div>
        <div class="compare-header-mid">△</div>
        <div class="compare-header-side ai-side">AI előrejelzés</div>
      </div>
      <div id="compareBody">
        <div style="padding:32px;text-align:center;color:var(--text-muted);font-size:.7rem;font-family:'JetBrains Mono',monospace;line-height:2.2">
          Generáld le az AI előrejelzést az összehasonlításhoz
        </div>
      </div>
    </div>
  </div>

  <div class="error-box" id="errorBox">
    <svg style="width:14px;height:14px;flex-shrink:0" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/><path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
    <span id="errorText"></span>
  </div>
</div>

<script>
/* ═══ PARTICLES ═══ */
const canvas=document.getElementById('particleCanvas');const ctx=canvas.getContext('2d');let W,H,particles=[];
function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;}
resize();window.addEventListener('resize',resize);
class Particle{constructor(){this.reset();}reset(){this.x=Math.random()*W;this.y=Math.random()*H;this.vx=(Math.random()-.5)*.3;this.vy=-Math.random()*.5-.1;this.size=Math.random()*1.5+.3;this.life=0;this.maxLife=Math.random()*200+100;this.green=Math.random()>.7;}update(){this.x+=this.vx;this.y+=this.vy;this.life++;if(this.life>this.maxLife||this.y<-10)this.reset();}draw(){const a=Math.sin((this.life/this.maxLife)*Math.PI)*.5;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fillStyle=this.green?`rgba(0,230,118,${a*.7})`:`rgba(180,220,255,${a*.25})`;ctx.fill();}}
for(let i=0;i<100;i++){const p=new Particle();p.life=Math.random()*p.maxLife;particles.push(p);}
function animParticles(){ctx.clearRect(0,0,W,H);for(let i=0;i<particles.length;i++)for(let j=i+1;j<particles.length;j++){const dx=particles[i].x-particles[j].x,dy=particles[i].y-particles[j].y,d=Math.sqrt(dx*dx+dy*dy);if(d<80){ctx.beginPath();ctx.moveTo(particles[i].x,particles[i].y);ctx.lineTo(particles[j].x,particles[j].y);ctx.strokeStyle=`rgba(0,180,100,${(1-d/80)*.035})`;ctx.lineWidth=.5;ctx.stroke();}}particles.forEach(p=>{p.update();p.draw();});requestAnimationFrame(animParticles);}
animParticles();

/* ═══ CONFIG & STATE ═══ */
const LLM7_URL='https://api.llm7.io/v1/chat/completions';
const LLM7_KEY='/WF1cs8NieiVJAvBfBR+n5Fb/vxRW1oSmv3EqtTSTRxWQBGMexqcI4Xivs+BqTXfNYMZI8OUFZpv5YAA0FOjcumYWgcG8AkhePVVO8zCVKQo3GMYfArXw2yPPKY7w3tRvofNvQ==';
let realStandings=[],aiStandingsCached=[],lastSeasonId=null,lastTotalPoints=null,currentTab='real';

/* ═══ UTILS ═══ */
function nowStr(){return new Date().toLocaleTimeString('hu-HU',{hour:'2-digit',minute:'2-digit',second:'2-digit'});}
function gd(gf,ga){const d=(gf||0)-(ga||0);if(d>0)return`<span style="color:var(--green);text-shadow:0 0 6px rgba(0,230,118,0.4)">+${d}</span>`;if(d<0)return`<span style="color:var(--red)">${d}</span>`;return`<span style="color:#1a2e3d">0</span>`;}
function trendHtml(t){if(t==='up')return'<span class="trend-up">▲</span>';if(t==='down')return'<span class="trend-down">▼</span>';return'<span class="trend-same">—</span>';}
function logoHtml(logo){if(!logo)return'<span class="team-logo-placeholder"></span>';return`<img class="team-logo" src="${logo}" alt="" loading="lazy" onerror="this.style.display='none'">`;}
function rowClass(pos,total){if(pos<=3)return'lb-row top3';if(total&&pos>total-3)return'lb-row relegation';return'lb-row';}
function showError(msg){document.getElementById('errorText').textContent=msg;document.getElementById('errorBox').classList.add('show');}
function hideError(){document.getElementById('errorBox').classList.remove('show');}

function setStep(n, state){
  for(let i=1;i<=4;i++){
    const el=document.getElementById('step'+i);
    if(!el)continue;
    el.className='step'+(i<n?' done':i===n?' active':'');
  }
}

/* ═══ AI CALL ═══ */
async function callAI(messages, temp=0.7, maxTokens=2048){
  const res=await fetch(LLM7_URL,{
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':`Bearer ${LLM7_KEY}`},
    body:JSON.stringify({model:'default',messages,temperature:temp,max_tokens:maxTokens})
  });
  if(!res.ok){const t=await res.text().catch(()=>'');throw new Error(`LLM7 ${res.status}: ${t.slice(0,120)}`);}
  const d=await res.json();
  return d.choices?.[0]?.message?.content||'';
}

/* ═══ FETCH REAL STANDINGS ═══ */
async function fetchRealStandings(){
  const res=await fetch('/api/standings?liga=pl');
  if(!res.ok)throw new Error(`API hiba: ${res.status}`);
  const data=await res.json();
  return{standings:data.standings||[],seasonId:data.seasonId||null};
}

/* ═══ ANALYTICS ═══ */
function computeStats(standings){
  const n=standings.length;
  if(n===0)return{totalPts:0,estMatches:0,seasonPhase:'',avgPpg:0,leader:null,lastPlace:null,biggestGD:null,worstGD:null};
  const totalPts=standings.reduce((s,t)=>s+(t.pts||0),0);
  const avgPts=totalPts/n;
  const estMatches=Math.max(1,Math.round(avgPts/1.75));
  const seasonPhase=totalPts<50?'SZEZON ELEJE':totalPts<280?'SZEZON KÖZEPE':'SZEZON VÉGE KÖZELÍT';
  const sorted=[...standings].sort((a,b)=>(b.pts||0)-(a.pts||0));
  const leader=sorted[0];
  const lastPlace=sorted[n-1];
  const byGD=[...standings].sort((a,b)=>((b.goalsFor||0)-(b.goalsAgainst||0))-((a.goalsFor||0)-(a.goalsAgainst||0)));
  return{totalPts,estMatches,seasonPhase,avgPts:avgPts.toFixed(1),avgPpg:(avgPts/estMatches).toFixed(2),leader,lastPlace,biggestGD:byGD[0],worstGD:byGD[n-1],n};
}

function renderStatCards(containerId, cards){
  const el=document.getElementById(containerId);
  if(!el)return;
  el.innerHTML=cards.map(c=>`
    <div class="stat-card ${c.color}">
      <div class="stat-card-label">${c.label}</div>
      <div class="stat-card-value">${c.value}</div>
      ${c.sub?`<div class="stat-card-sub">${c.sub}</div>`:''}
    </div>`).join('');
  el.style.display='grid';
}

/* ═══ RENDER REAL TABLE ═══ */
function renderRealTable(standings){
  const table=document.getElementById('realTable'),meta=document.getElementById('realMeta');
  if(!standings||standings.length===0){table.innerHTML='<div style="padding:20px;text-align:center;color:var(--text-muted);font-size:.7rem">Nincs adat</div>';return;}
  const total=standings.length;
  const maxPts=Math.max(...standings.map(r=>r.pts||0))||1;
  const stats=computeStats(standings);
  table.innerHTML=standings.map((r,i)=>{
    const ppg=stats.estMatches>0?((r.pts||0)/stats.estMatches).toFixed(2):'–';
    const barW=Math.round(((r.pts||0)/maxPts)*100);
    return`<div class="${rowClass(r.pos,total)}" style="animation-delay:${i*.025}s">
      <span class="col-pos">${r.pos}</span>
      <span class="col-trend">${trendHtml(r.trend??'same')}</span>
      <span class="col-team">${logoHtml(r.logo)}<span class="team-name">${r.team}</span></span>
      <span class="col-pts-wrap"><span class="col-pts">${r.pts??0}</span><div class="pts-bar"><div class="pts-bar-fill" style="width:${barW}%"></div></div></span>
      <span class="col-goals">${r.goalsFor??'–'}:${r.goalsAgainst??'–'}</span>
      <span class="col-gd">${gd(r.goalsFor,r.goalsAgainst)}</span>
      <span class="col-goals" style="color:var(--text-dim)">${ppg}</span>
    </div>`;
  }).join('');
  meta.className='lb-meta';meta.querySelector('span:first-child').innerHTML='<span class="refresh-dot"></span>Élő adat';
  document.getElementById('realUpdateTime').textContent=nowStr();
  // stat cards
  if(stats.leader){
    renderStatCards('realStatCards',[
      {label:'Vezető',color:'green',value:stats.leader.team,sub:`${stats.leader.pts} pont · +${(stats.leader.goalsFor||0)-(stats.leader.goalsAgainst||0)} GD`},
      {label:'Becsült fordulók',color:'amber',value:`~${stats.estMatches} mérkőzés`,sub:`Összes pont: ${stats.totalPts}`},
      {label:'Sereghajtó',color:'red',value:stats.lastPlace.team,sub:`${stats.lastPlace.pts} pont`},
    ]);
  }
}

async function loadRealTable(){
  const meta=document.getElementById('realMeta');
  meta.className='lb-meta loading';meta.querySelector('span:first-child').innerHTML='<span class="refresh-dot"></span>Betöltés...';
  try{
    const{standings,seasonId}=await fetchRealStandings();
    detectSeasonReset(standings,seasonId);
    realStandings=standings;
    renderRealTable(standings);
  }catch(e){
    showError(e.message);
    meta.className='lb-meta error';meta.querySelector('span:first-child').innerHTML='<span class="refresh-dot"></span>Hiba';
  }
}

/* ═══ BUILD EXPERT AI PROMPT ═══ */
function buildAIPrompt(standings){
  const stats=computeStats(standings);
  const n=standings.length;
  const remainingMatches=Math.max(2,Math.round((38-stats.estMatches)*1.2));

  const teamsData=standings.map(t=>{
    const gdVal=(t.goalsFor||0)-(t.goalsAgainst||0);
    const ppg=stats.estMatches>0?((t.pts||0)/stats.estMatches).toFixed(2):'?';
    const attackStr=t.goalsFor>0?(t.goalsFor/stats.estMatches).toFixed(1):'?';
    const defStr=t.goalsAgainst>0?(t.goalsAgainst/stats.estMatches).toFixed(1):'?';
    return`${t.pos}. ${t.team}: pts=${t.pts}, GF=${t.goalsFor||0}, GA=${t.goalsAgainst||0}, GD=${gdVal>0?'+'+gdVal:gdVal}, PPM=${ppg}, GFM=${attackStr}, GAM=${defStr}`;
  }).join('\n');

  return`Te egy professionális virtuális futball liga statisztikai modell vagy, amely a jelenlegi szezonstatisztikák alapján pontos szezon végi előrejelzést generál.

JELENLEGI ÁLLAPOT (${stats.seasonPhase}):
- Lejátszott fordulók (becsült): ~${stats.estMatches}
- Hátralévő fordulók (becsült): ~${remainingMatches}
- Összes pont a ligában: ${stats.totalPts}
- Csapatok száma: ${n}

CSAPAT STATISZTIKÁK (PPM=pont/mérkőzés, GFM=gól lőtt/mérkőzés, GAM=gól kapott/mérkőzés):
${teamsData}

ELEMZÉSI MÓDSZERTAN:
1. Extrapolálj a PPM alapján: ha egy csapat ${stats.estMatches} fordulón át X PPM-et teljesített, várhatóan folytatja ezt
2. A magas GD (>+15) jelzi az erős csapatokat, akik valószínűleg a top3-ban maradnak
3. A negatív GD (<-10) relegációs veszélyt jelez
4. Adj regressziót az extrém értékekre (a legjobb csapatok kicsit visszaesnek, a legrosszabbak kicsit javulnak)
5. Legalább ${Math.ceil(n*0.35)} csapat pozíciója változzon

ELŐREJELZÉSI SZABÁLYOK:
- Minden csapatnak legyen pts értéke (>0)
- Az 1. helyezettnek ~${Math.round(stats.leader?(stats.leader.pts/stats.estMatches)*(stats.estMatches+remainingMatches)*0.95:75)} pont körül kellene lennie szezon végén
- A GD maradjon arányos (top csapatok pozitív, kiesők negatív)
- trend: "up" ha előrébb kerül a mostanihoz képest, "down" ha hátrébb, "same" ha marad
- goalsFor és goalsAgainst legyen reális, ne 0

VÁLASZOLJ CSAK VALID JSON TÖMBBEL, semmi más:
[{"pos":1,"team":"CSAPATNÉV","goalsFor":80,"goalsAgainst":30,"pts":88,"trend":"same"},...]`;
}

/* ═══ RENDER AI TABLE ═══ */
function renderAITable(aiStandings){
  const aiTable=document.getElementById('aiTable');
  const total=aiStandings.length;
  const maxPts=Math.max(...aiStandings.map(r=>r.pts||0))||1;
  aiTable.innerHTML=aiStandings.map((r,i)=>{
    const confScore=Math.min(100,Math.round(50+r.pts*0.5));
    const confColor=confScore>75?'var(--green)':confScore>50?'var(--amber)':'var(--red)';
    const barW=Math.round(((r.pts||0)/maxPts)*100);
    return`<div class="${rowClass(r.pos,total)}" style="animation-delay:${i*.03}s">
      <span class="col-pos">${r.pos}</span>
      <span class="col-trend">${trendHtml(r.trend)}</span>
      <span class="col-team"><span class="team-logo-placeholder"></span><span class="team-name">${r.team}</span></span>
      <span class="col-conf"><div class="conf-bar"><div class="conf-fill" style="width:${Math.min(100,Math.round((r.pts/maxPts)*100))}%;background:${confColor}"></div></div></span>
      <span class="col-goals">${r.goalsFor}:${r.goalsAgainst}</span>
      <span class="col-gd">${gd(r.goalsFor,r.goalsAgainst)}</span>
      <span class="col-pts-wrap"><span class="col-pts">${r.pts}</span><div class="pts-bar"><div class="pts-bar-fill" style="width:${barW}%"></div></div></span>
    </div>`;
  }).join('');
}

/* ═══ RENDER COMPARE VIEW ═══ */
function renderCompare(){
  const body=document.getElementById('compareBody');
  if(!realStandings.length||!aiStandingsCached.length){
    body.innerHTML='<div style="padding:32px;text-align:center;color:var(--text-muted);font-size:.7rem;font-family:\'JetBrains Mono\',monospace">Generáld le az AI előrejelzést az összehasonlításhoz</div>';
    return;
  }
  const maxPos=Math.max(realStandings.length,aiStandingsCached.length);
  // Build lookup by team name
  const realByTeam=Object.fromEntries(realStandings.map(t=>[t.team,t]));
  const aiByTeam=Object.fromEntries(aiStandingsCached.map(t=>[t.team,t]));
  // Use real order
  body.innerHTML=realStandings.map((r,i)=>{
    const aiTeam=aiByTeam[r.team]||{pos:'?',pts:'?'};
    const diff=typeof aiTeam.pos==='number'?r.pos-aiTeam.pos:0;
    let moveBadge='';
    if(diff>0)moveBadge=`<span class="move-badge move-up">+${diff}↑</span>`;
    else if(diff<0)moveBadge=`<span class="move-badge move-down">${diff}↓</span>`;
    else moveBadge=`<span class="move-badge move-same">═</span>`;
    return`<div class="compare-row" style="animation-delay:${i*.02}s">
      <div class="compare-team real-side">
        <span class="compare-pos" style="color:${r.pos<=3?'var(--green)':r.pos>realStandings.length-3?'var(--red)':'var(--text-dim)'}">${r.pos}</span>
        <span class="compare-name">${r.team}</span>
        <span class="compare-pts" style="margin-left:auto">${r.pts??'–'}</span>
      </div>
      <div class="compare-mid">${moveBadge}</div>
      <div class="compare-team ai-side">
        <span class="compare-pos" style="color:${typeof aiTeam.pos==='number'&&aiTeam.pos<=3?'var(--cyan)':typeof aiTeam.pos==='number'&&aiTeam.pos>realStandings.length-3?'var(--amber)':'var(--text-dim)'}">${aiTeam.pos}</span>
        <span class="compare-name">${r.team}</span>
        <span class="compare-pts" style="margin-left:auto;color:var(--cyan)">${aiTeam.pts??'–'}</span>
      </div>
    </div>`;
  }).join('');
}

/* ═══ GENERATE AI TABLE ═══ */
async function generateAITable(){
  const meta=document.getElementById('aiMeta');
  const aiPanel=document.getElementById('aiPanel');
  const generateBtn=document.getElementById('generateAIBtn');
  const refreshBtn=document.getElementById('refreshAIBtn');
  const progressEl=document.getElementById('aiProgress');
  const aiStatCardsEl=document.getElementById('aiStatCards');

  generateBtn.disabled=true;
  refreshBtn.style.display='none';
  progressEl.classList.add('show');
  meta.className='lb-meta loading';
  meta.querySelector('span:first-child').innerHTML='<span class="refresh-dot"></span>AI elemzés...';
  document.getElementById('aiTable').innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  aiPanel.style.display='none';
  aiStatCardsEl.style.display='none';
  hideError();

  try{
    // STEP 1 – Adatok betöltése
    setStep(1,'active');
    if(realStandings.length===0){
      const{standings,seasonId}=await fetchRealStandings();
      detectSeasonReset(standings,seasonId);
      realStandings=standings;
    }
    if(realStandings.length===0)throw new Error('Nincs elérhető valós adat');
    const stats=computeStats(realStandings);
    await new Promise(r=>setTimeout(r,300)); // slight pause for UX

    // STEP 2 – AI előrejelzés generálása (multi-turn for better quality)
    setStep(2,'active');
    const systemMsg={role:'system',content:'Te egy precíz virtuális futball liga statisztikai elemző és előrejelző rendszer vagy. Mindig valid JSON tömbbel válaszolsz, semmi más szöveggel. A JSON minden objektumában szerepelnie kell: pos (szám), team (szöveg), goalsFor (szám), goalsAgainst (szám), pts (pozitív szám>0), trend (up/down/same).'};
    const userMsg={role:'user',content:buildAIPrompt(realStandings)};
    const text=await callAI([systemMsg,userMsg],0.72,3000);

    // Robusztus JSON parse
    let clean=text.replace(/```json\s*/gi,'').replace(/```\s*/g,'').trim();
    const start=clean.indexOf('[');
    const end=clean.lastIndexOf(']');
    if(start===-1||end===-1||end<=start)throw new Error('Nem érkezett valid JSON a modelltől');
    let parsed;
    try{parsed=JSON.parse(clean.slice(start,end+1));}
    catch(je){throw new Error('JSON parse hiba: '+je.message+' | Szöveg: '+clean.slice(start,Math.min(start+100,end+1)));}

    // Normalize & validate
    const aiStandings=parsed
      .filter(r=>r&&typeof r==='object'&&r.team)
      .map((r,i)=>({
        pos:typeof r.pos==='number'&&r.pos>0?Math.round(r.pos):i+1,
        team:String(r.team||'?').trim(),
        goalsFor:typeof r.goalsFor==='number'&&r.goalsFor>=0?r.goalsFor:(r.gf||r.goals_for||Math.floor(40+Math.random()*30)),
        goalsAgainst:typeof r.goalsAgainst==='number'&&r.goalsAgainst>=0?r.goalsAgainst:(r.ga||r.goals_against||Math.floor(25+Math.random()*25)),
        pts:typeof r.pts==='number'&&r.pts>0?r.pts:(typeof r.points==='number'&&r.points>0?r.points:Math.max(1,Math.round(70-(i*3)))),
        trend:['up','down','same'].includes(r.trend)?r.trend:'same'
      }))
      .sort((a,b)=>a.pos-b.pos);

    if(aiStandings.length<2)throw new Error('Az AI túl kevés csapatot adott vissza ('+aiStandings.length+')');

    aiStandingsCached=[...aiStandings];

    // STEP 4 – Render
    setStep(4,'active');
    renderAITable(aiStandings);
    meta.className='lb-meta';
    meta.querySelector('span:first-child').innerHTML='<span class="refresh-dot"></span>AI becslés kész';
    document.getElementById('aiUpdateTime').textContent=nowStr();

    // AI insight stat cards
    const aiStats=computeStats(aiStandings);
    const biggestMover=aiStandings.reduce((best,r)=>{
      const realR=realStandings.find(x=>x.team===r.team);
      if(!realR)return best;
      const diff=realR.pos-r.pos;
      return Math.abs(diff)>Math.abs(best.diff)?{team:r.team,diff,pos:r.pos}:best;
    },{team:'?',diff:0,pos:0});
    renderStatCards('aiStatCards',[
      {label:'AI Bajnok Jelölt',color:'green',value:aiStandings[0]?.team||'?',sub:`${aiStandings[0]?.pts} pont (becsült)`},
      {label:'Legnagyobb Ugrás',color:'purple',value:biggestMover.team,sub:biggestMover.diff>0?`+${biggestMover.diff} hely feljebb`:biggestMover.diff<0?`${biggestMover.diff} hely lejjebb`:'Nincs változás'},
      {label:'Veszélyzónában',color:'red',value:aiStandings[aiStandings.length-1]?.team||'?',sub:`${aiStandings[aiStandings.length-1]?.pts} pont (utolsó)`},
    ]);
    progressEl.classList.remove('show');

    // STEP 3 – Szöveges elemzés
    setStep(3,'active');
    const top3=aiStandings.slice(0,3).map(t=>`${t.pos}. ${t.team} (${t.pts}pt)`).join(', ');
    const bot3=aiStandings.slice(-3).map(t=>`${t.pos}. ${t.team} (${t.pts}pt)`).join(', ');
    const movers=aiStandings.filter(r=>{
      const re=realStandings.find(x=>x.team===r.team);
      return re&&Math.abs(re.pos-r.pos)>=3;
    }).slice(0,3).map(r=>{
      const re=realStandings.find(x=>x.team===r.team);
      const d=re.pos-r.pos;
      return`${r.team} (${d>0?'+'+d:d} hely)`;
    }).join(', ')||'minimális pozíciómozgások';

    const analMessages=[
      {role:'system',content:'Magyar focielemző vagy. Tömören, tényszerűen és érdekesen elemzel. Kerüld az általánosságokat.'},
      {role:'user',content:`Rövid, informatív magyar elemzés (4-5 mondat) a virtuális liga AI előrejelzéséről:\n\nVárható dobogó: ${top3}\nVárható kiesők: ${bot3}\nNagyobb helyzetváltozás: ${movers}\nBecsült fordulók (~${stats.estMatches} lejátszva, ~${Math.max(2,38-stats.estMatches)} hátra)\n\nMagyarázd meg, miért ezeket a csapatokat és miért ezeket a pozíciókat jósolja a modell!`}
    ];
    const analText=await callAI(analMessages,0.65,600);
    if(analText){
      document.getElementById('aiBody').innerHTML=analText.replace(/\n\n/g,'</p><p>').replace(/\n/g,'<br>');
      aiPanel.style.display='block';
    }
    setStep(5,'done'); // all done

    // Update compare
    renderCompare();

  }catch(e){
    showError('AI hiba: '+e.message);
    meta.className='lb-meta error';
    meta.querySelector('span:first-child').innerHTML='<span class="refresh-dot"></span>Hiba';
    document.getElementById('aiTable').innerHTML='<div style="padding:32px;text-align:center;color:var(--text-muted);font-size:.7rem;font-family:\'JetBrains Mono\',monospace">Hiba. Próbáld újra.</div>';
    progressEl.classList.remove('show');
  }finally{
    generateBtn.disabled=false;
    refreshBtn.style.display='flex';
  }
}

/* ═══ SEASON RESET ═══ */
function detectSeasonReset(standings,serverSeasonId){
  const totalPoints=standings.reduce((s,t)=>s+(t.pts||0),0);
  let isReset=false;
  if(serverSeasonId&&lastSeasonId&&serverSeasonId!==lastSeasonId)isReset=true;
  if(lastTotalPoints!==null&&lastTotalPoints>100&&totalPoints<lastTotalPoints*.3)isReset=true;
  if(isReset){
    const notice=document.getElementById('seasonNotice');
    document.getElementById('seasonNoticeText').textContent=serverSeasonId?`Új szezon (ID: ${serverSeasonId})`:'Szezonváltás érzékelve';
    notice.style.display='flex';
    aiStandingsCached=[];
    document.getElementById('aiTable').innerHTML='<div style="padding:32px;text-align:center;color:var(--text-muted);font-size:.7rem;font-family:\'JetBrains Mono\',monospace">Új szezon! Kattints a "Generálás" gombra.</div>';
    document.getElementById('aiPanel').style.display='none';
  }
  lastTotalPoints=totalPoints;
  if(serverSeasonId)lastSeasonId=serverSeasonId;
}

/* ═══ TABS ═══ */
function showTab(tab){
  currentTab=tab;
  ['real','ai','compare'].forEach(t=>{
    document.getElementById(t+'Container').style.display=t===tab?'block':'none';
    document.getElementById(t+'Tab').classList.toggle('active',t===tab);
  });
  if(tab==='compare')renderCompare();
}

/* ═══ INIT ═══ */
document.addEventListener('DOMContentLoaded',()=>{
  loadRealTable();
  document.getElementById('refreshRealBtn').addEventListener('click',loadRealTable);
  document.getElementById('generateAIBtn').addEventListener('click',generateAITable);
  document.getElementById('refreshAIBtn').addEventListener('click',generateAITable);
  setInterval(loadRealTable,30000);
});
</script>
</body>
</html>
